(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{Qilz:function(t,e,n){"use strict";n.d(e,"a",function(){return hp});var r=n("HDdC"),i=n("fXoL"),o=n("edgM"),s=n("D0XW"),a=n("Cfvw"),u=n("LRne"),c=n("JX91"),h=n("7o/Q");function l(){return t=>t.lift(new f)}class f{call(t,e){return e.subscribe(new d(t))}}class d extends h.a{constructor(t){super(t),this.hasPrev=!1}_next(t){let e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}var p=n("lJxs"),y=n("Kqap");class g{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new v(t,this.compare,this.keySelector))}}class v extends h.a{constructor(t,e,n){super(t),this.keySelector=n,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e;try{const{keySelector:n}=this;e=n?n(t):t}catch(r){return this.destination.error(r)}let n=!1;if(this.hasKey)try{const{compare:t}=this;n=t(this.key,e)}catch(r){return this.destination.error(r)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))}}var m=n("pLZG"),b=n("pxpQ"),w=n("spgP"),I=n("ofXK"),T=n("Jgta"),E=n("zIRd"),_=n("mrSG"),O=n("qOnz"),S=n("q/0M"),A=function(t,e){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function N(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var D,j="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},k=k||{},C=j||self;function x(){}function R(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var L="closure_uid_"+(1e9*Math.random()>>>0),F=0;function M(t,e,n){return t.call.apply(t.bind,arguments)}function q(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function V(t,e,n){return(V=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:q).apply(null,arguments)}function U(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function B(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function K(){this.s=this.s,this.o=this.o}var G={};K.prototype.s=!1,K.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,L)&&t[L]||(t[L]=++F)}(this);delete G[t]}},K.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var z=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Q=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function W(t){return Array.prototype.concat.apply([],arguments)}function H(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Y(t){return/^[\s\xa0]*$/.test(t)}var X,$=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function J(t,e){return-1!=t.indexOf(e)}function Z(t,e){return t<e?-1:t>e?1:0}t:{var tt=C.navigator;if(tt){var et=tt.userAgent;if(et){X=et;break t}}X=""}function nt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function rt(t){var e={};for(var n in t)e[n]=t[n];return e}var it="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ot(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<it.length;o++)n=it[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function st(t){return st[" "](t),t}st[" "]=x;var at,ut,ct=J(X,"Opera"),ht=J(X,"Trident")||J(X,"MSIE"),lt=J(X,"Edge"),ft=lt||ht,dt=J(X,"Gecko")&&!(J(X.toLowerCase(),"webkit")&&!J(X,"Edge"))&&!(J(X,"Trident")||J(X,"MSIE"))&&!J(X,"Edge"),pt=J(X.toLowerCase(),"webkit")&&!J(X,"Edge");function yt(){var t=C.document;return t?t.documentMode:void 0}t:{var gt="",vt=(ut=X,dt?/rv:([^\);]+)(\)|;)/.exec(ut):lt?/Edge\/([\d\.]+)/.exec(ut):ht?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ut):pt?/WebKit\/(\S+)/.exec(ut):ct?/(?:Version)[ \/]?(\S+)/.exec(ut):void 0);if(vt&&(gt=vt?vt[1]:""),ht){var mt=yt();if(null!=mt&&mt>parseFloat(gt)){at=String(mt);break t}}at=gt}var bt={};var wt=C.document&&ht&&(yt()||parseInt(at,10))||void 0,It=function(){if(!C.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{C.addEventListener("test",x,e),C.removeEventListener("test",x,e)}catch(n){}return t}();function Tt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Et(t,e){if(Tt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(dt){t:{try{st(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:_t[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Et.Z.h.call(this)}}Tt.prototype.h=function(){this.defaultPrevented=!0},B(Et,Tt);var _t={2:"touch",3:"pen",4:"mouse"};Et.prototype.h=function(){Et.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Ot="closure_listenable_"+(1e6*Math.random()|0),St=0;function At(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++St,this.ca=this.fa=!1}function Nt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Dt(t){this.src=t,this.g={},this.h=0}function jt(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=z(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Nt(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function kt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Dt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=kt(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new At(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Ct="closure_lm_"+(1e6*Math.random()|0),xt={};function Rt(t,e,n,r,i){if(r&&r.once)return Lt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);return null}return n=Kt(n),t&&t[Ot]?t.N(e,n,P(r)?!!r.capture:!!r,i):Pt(t,e,n,!1,r,i)}function Pt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=P(i)?!!i.capture:!!i,a=Ut(t);if(a||(t[Ct]=a=new Dt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Vt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)It||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(qt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Lt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Lt(t,e[o],n,r,i);return null}return n=Kt(n),t&&t[Ot]?t.O(e,n,P(r)?!!r.capture:!!r,i):Pt(t,e,n,!0,r,i)}function Ft(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Ft(t,e[o],n,r,i);else r=P(r)?!!r.capture:!!r,n=Kt(n),t&&t[Ot]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=kt(o=t.g[e],n,r,i))&&(Nt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=Ut(t))&&(e=t.g[e.toString()],t=-1,e&&(t=kt(e,n,r,i)),(n=-1<t?e[t]:null)&&Mt(n))}function Mt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[Ot])jt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(qt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ut(e))?(jt(n,t),0==n.h&&(n.src=null,e[Ct]=null)):Nt(t)}}}function qt(t){return t in xt?xt[t]:xt[t]="on"+t}function Vt(t,e){if(t.ca)t=!0;else{e=new Et(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Mt(t),t=n.call(r,e)}return t}function Ut(t){return(t=t[Ct])instanceof Dt?t:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Kt(t){return"function"==typeof t?t:(t[Bt]||(t[Bt]=function(e){return t.handleEvent(e)}),t[Bt])}function Gt(){K.call(this),this.i=new Dt(this),this.P=this,this.I=null}function zt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new Tt(e,t);else if(e instanceof Tt)e.target=e.target||t;else{var i=e;ot(e=new Tt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=Qt(s,r,!0,e)&&i}if(i=Qt(s=e.g=t,r,!0,e)&&i,i=Qt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Qt(s=e.g=n[o],r,!1,e)&&i}function Qt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&jt(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}B(Gt,K),Gt.prototype[Ot]=!0,Gt.prototype.removeEventListener=function(t,e,n,r){Ft(this,t,e,n,r)},Gt.prototype.M=function(){if(Gt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Nt(n[r]);delete e.g[t],e.h--}}this.I=null},Gt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Gt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Wt=C.JSON.stringify;function Ht(){var t=ne,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Yt,Xt=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=$t.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),$t=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new Jt},function(t){return t.reset()}),Jt=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Zt(t){C.setTimeout(function(){throw t},0)}function te(t,e){Yt||function(){var t=C.Promise.resolve(void 0);Yt=function(){t.then(re)}}(),ee||(Yt(),ee=!0),ne.add(t,e)}var ee=!1,ne=new Xt;function re(){for(var t;t=Ht();){try{t.h.call(t.g)}catch(n){Zt(n)}var e=$t;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}ee=!1}function ie(t,e){Gt.call(this),this.h=t||1,this.g=e||C,this.j=V(this.kb,this),this.l=Date.now()}function oe(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function se(t,e,n){if("function"==typeof t)n&&(t=V(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=V(t.handleEvent,t)}return 2147483647<Number(e)?-1:C.setTimeout(t,e||0)}function ae(t){t.g=se(function(){t.g=null,t.i&&(t.i=!1,ae(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}B(ie,Gt),(D=ie.prototype).da=!1,D.S=null,D.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),zt(this,"tick"),this.da&&(oe(this),this.start()))}},D.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},D.M=function(){ie.Z.M.call(this),oe(this),delete this.g};var ue=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:ae(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(C.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(K);function ce(t){K.call(this),this.h=t,this.g={}}B(ce,K);var he=[];function le(t,e,n,r){Array.isArray(n)||(n&&(he[0]=n.toString()),n=he);for(var i=0;i<n.length;i++){var o=Rt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function fe(t){nt(t.g,function(t,e){this.g.hasOwnProperty(e)&&Mt(t)},t),t.g={}}function de(){this.g=!0}function pe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Wt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}ce.prototype.M=function(){ce.Z.M.call(this),fe(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},de.prototype.Aa=function(){this.g=!1},de.prototype.info=function(){};var ye={},ge=null;function ve(){return ge=ge||new Gt}function me(t){Tt.call(this,ye.Ma,t)}function be(t){var e=ve();zt(e,new me(e,t))}function we(t,e){Tt.call(this,ye.STAT_EVENT,t),this.stat=e}function Ie(t){var e=ve();zt(e,new we(e,t))}function Te(t,e){Tt.call(this,ye.Na,t),this.size=e}function Ee(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return C.setTimeout(function(){t()},e)}ye.Ma="serverreachability",B(me,Tt),ye.STAT_EVENT="statevent",B(we,Tt),ye.Na="timingevent",B(Te,Tt);var _e={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Oe={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Se(){}function Ae(){}Se.prototype.h=null;var Ne,De={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function je(){Tt.call(this,"d")}function ke(){Tt.call(this,"c")}function Ce(){}function xe(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new ce(this),this.P=Pe,this.W=new ie(t=ft?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Re}function Re(){this.i=null,this.g="",this.h=!1}B(je,Tt),B(ke,Tt),B(Ce,Se),Ce.prototype.g=function(){return new XMLHttpRequest},Ce.prototype.i=function(){return{}},Ne=new Ce;var Pe=45e3,Le={},Fe={};function Me(t,e,n){t.K=1,t.v=un(en(e)),t.s=n,t.U=!0,qe(t,null)}function qe(t,e){t.F=Date.now(),Ke(t),t.A=en(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),In(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Re,t.g=Tr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new ue(V(t.Ia,t,t.g),t.O)),le(t.V,t.g,"readystatechange",t.gb),e=t.H?rt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),be(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ve(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Ue(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=Be(t,n))==Fe){4==e&&(t.o=4,Ie(14),i=!1),pe(t.j,t.m,null,"[Incomplete Response]");break}if(r==Le){t.o=4,Ie(15),pe(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}pe(t.j,t.m,r,null),He(t,r)}Ve(t)&&r!=Fe&&r!=Le&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Ie(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),pr(e),e.L=!0,Ie(11))):(pe(t.j,t.m,n,"[Invalid Chunked Response]"),We(t),Qe(t))}function Be(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Fe:(n=Number(e.substring(n,r)),isNaN(n)?Le:(r+=1)+n>e.length?Fe:(e=e.substr(r,n),t.C=r+n,e))}function Ke(t){t.Y=Date.now()+t.P,Ge(t,t.P)}function Ge(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Ee(V(t.eb,t),e)}function ze(t){t.B&&(C.clearTimeout(t.B),t.B=null)}function Qe(t){0==t.l.G||t.I||vr(t.l,t)}function We(t){ze(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,oe(t.W),fe(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function He(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Nn(n.i,t)))if(n.I=t.N,!t.J&&Nn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;gr(n),or(n)}dr(n),Ie(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Ee(V(n.ab,n),6e3));if(1>=An(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else br(n,11)}else if((t.J||n.g==t)&&gr(n),!Y(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(J(h,"spdy")||J(h,"quic")||J(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(Dn(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,an(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=Ir(r,r.H?r.la:null,r.W),d.J){jn(r.i,d);var p=d,y=r.K;y&&p.setTimeout(y),p.B&&(ze(p),Ke(p)),r.g=d}else fr(r);0<n.l.length&&ur(n)}else"stop"!=o[0]&&"close"!=o[0]||br(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?br(n,7):ir(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}be(4)}catch(o){}}function Ye(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(R(t)||"string"==typeof t)Q(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(R(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(R(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Xe(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Xe)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function $e(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Je(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Je(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function Je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(D=xe.prototype).setTimeout=function(t){this.P=t},D.gb=function(t){t=t.target;var e=this.L;e&&3==Zn(t)?e.l():this.Ia(t)},D.Ia=function(t){try{if(t==this.g)t:{var e=Zn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||ft||this.g&&(this.h.h||this.g.ga()||tr(this.g)))){this.I||4!=e||7==n||be(8==n||0>=r?3:2),ze(this);var i=this.g.ba();this.N=i;e:if(Ve(this)){var o=tr(this.g);t="";var s=o.length,a=4==Zn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){We(this),Qe(this);var u="";break e}this.h.i=new C.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Y(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,Ie(12),We(this),Qe(this);break t}pe(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,He(this,i)}this.U?(Ue(this,e,u),ft&&this.i&&3==e&&(le(this.V,this.W,"tick",this.fb),this.W.start())):(pe(this.j,this.m,u,null),He(this,u)),4==e&&We(this),this.i&&!this.I&&(4==e?vr(this.l,this):(this.i=!1,Ke(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,Ie(12)):(this.o=0,Ie(13)),We(this),Qe(this)}}}catch(e){}},D.fb=function(){if(this.g){var t=Zn(this.g),e=this.g.ga();this.C<e.length&&(ze(this),Ue(this,t,e),this.i&&4!=t&&Ke(this))}},D.cancel=function(){this.I=!0,We(this)},D.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(be(3),Ie(17)),We(this),this.o=2,Qe(this)):Ge(this,this.Y-t)},(D=Xe.prototype).R=function(){$e(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},D.T=function(){return $e(this),this.g.concat()},D.get=function(t,e){return Je(this.h,t)?this.h[t]:e},D.set=function(t,e){Je(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},D.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ze=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function tn(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof tn){this.g=void 0!==e?e:t.g,nn(this,t.j),this.s=t.s,rn(this,t.i),on(this,t.m),this.l=t.l,e=t.h;var n=new vn;n.i=e.i,e.g&&(n.g=new Xe(e.g),n.h=e.h),sn(this,n),this.o=t.o}else t&&(n=String(t).match(Ze))?(this.g=!!e,nn(this,n[1]||"",!0),this.s=cn(n[2]||""),rn(this,n[3]||"",!0),on(this,n[4]),this.l=cn(n[5]||"",!0),sn(this,n[6]||"",!0),this.o=cn(n[7]||"")):(this.g=!!e,this.h=new vn(null,this.g))}function en(t){return new tn(t)}function nn(t,e,n){t.j=n?cn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function rn(t,e,n){t.i=n?cn(e,!0):e}function on(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function sn(t,e,n){e instanceof vn?(t.h=e,function(t,e){e&&!t.j&&(mn(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(bn(this,e),In(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=hn(e,yn)),t.h=new vn(e,t.g))}function an(t,e,n){t.h.set(e,n)}function un(t){return an(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function cn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ln),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ln(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}tn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(hn(e,fn,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(hn(e,fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?pn:dn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",hn(n,gn)),t.join("")};var fn=/[#\/\?@]/g,dn=/[#\?:]/g,pn=/[#\?]/g,yn=/[#\?@]/g,gn=/#/g;function vn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function mn(t){t.g||(t.g=new Xe,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function bn(t,e){mn(t),e=Tn(t,e),Je(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Je((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&$e(t)))}function wn(t,e){return mn(t),e=Tn(t,e),Je(t.g.h,e)}function In(t,e,n){bn(t,e),0<n.length&&(t.i=null,t.g.set(Tn(t,e),H(n)),t.h+=n.length)}function Tn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(D=vn.prototype).add=function(t,e){mn(this),this.i=null,t=Tn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},D.forEach=function(t,e){mn(this),this.g.forEach(function(n,r){Q(n,function(n){t.call(e,n,r,this)},this)},this)},D.T=function(){mn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},D.R=function(t){mn(this);var e=[];if("string"==typeof t)wn(this,t)&&(e=W(e,this.g.get(Tn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},D.set=function(t,e){return mn(this),this.i=null,wn(this,t=Tn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},D.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},D.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var En=function(){return function(t,e){this.h=t,this.g=e}}();function _n(t){this.l=t||On,t=C.PerformanceNavigationTiming?0<(t=C.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(C.g&&C.g.Ea&&C.g.Ea()&&C.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var On=10;function Sn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function An(t){return t.h?1:t.g?t.g.size:0}function Nn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Dn(t,e){t.g?t.g.add(e):t.h=e}function jn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function kn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=N(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return H(t.i)}function Cn(){}function xn(){this.g=new Cn}function Rn(t,e,n){var r=n||"";try{Ye(t,function(t,n){var i=t;P(t)&&(i=Wt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(Kd){throw e.push(r+"type="+encodeURIComponent("_badmap")),Kd}}function Pn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function Ln(t){this.l=t.$b||null,this.j=t.ib||!1}function Fn(t,e){Gt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Mn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_n.prototype.cancel=function(){var t,e;if(this.i=kn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=N(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},Cn.prototype.stringify=function(t){return C.JSON.stringify(t,void 0)},Cn.prototype.parse=function(t){return C.JSON.parse(t,void 0)},B(Ln,Se),Ln.prototype.g=function(){return new Fn(this.l,this.j)},Ln.prototype.i=function(t){return function(){return t}}({}),B(Fn,Gt);var Mn=0;function qn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Vn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Un(t)}function Un(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(D=Fn.prototype).open=function(t,e){if(this.readyState!=Mn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Un(this)},D.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||C).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},D.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Vn(this)),this.readyState=Mn},D.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Un(this)),this.g&&(this.readyState=3,Un(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==C.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;qn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},D.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Vn(this):Un(this),3==this.readyState&&qn(this)}},D.Ua=function(t){this.g&&(this.response=this.responseText=t,Vn(this))},D.Ta=function(t){this.g&&(this.response=t,Vn(this))},D.ha=function(){this.g&&Vn(this)},D.setRequestHeader=function(t,e){this.v.append(t,e)},D.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},D.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Fn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Bn=C.JSON.parse;function Kn(t){Gt.call(this),this.headers=new Xe,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Gn,this.K=this.L=!1}B(Kn,Gt);var Gn="",zn=/^https?$/i,Qn=["POST","PUT"];function Wn(t){return"content-type"==t.toLowerCase()}function Hn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Yn(t),$n(t)}function Yn(t){t.D||(t.D=!0,zt(t,"complete"),zt(t,"error"))}function Xn(t){if(t.h&&void 0!==k&&(!t.C[1]||4!=Zn(t)||2!=t.ba()))if(t.v&&4==Zn(t))se(t.Fa,0,t);else if(zt(t,"readystatechange"),4==Zn(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(Ze)[1]||null;if(!o&&C.self&&C.self.location){var s=C.self.location.protocol;o=s.substr(0,s.length-1)}i=!zn.test(o?o.toLowerCase():"")}e=i}if(e)zt(t,"complete"),zt(t,"success");else{t.m=6;try{var a=2<Zn(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",Yn(t)}}finally{$n(t)}}}function $n(t,e){if(t.g){Jn(t);var n=t.g,r=t.C[0]?x:null;t.g=null,t.C=null,e||zt(t,"ready");try{n.onreadystatechange=r}catch(Kd){}}}function Jn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(C.clearTimeout(t.A),t.A=null)}function Zn(t){return t.g?t.g.readyState:0}function tr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Gn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return nt(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):an(t,e,n))}function nr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function rr(t){this.za=0,this.l=[],this.h=new de,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=nr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=nr("baseRetryDelayMs",5e3,t),this.$a=nr("retryDelaySeedMs",1e4,t),this.Ya=nr("forwardChannelMaxRetries",2,t),this.ra=nr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new _n(t&&t.concurrentRequestLimit),this.Ca=new xn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function ir(t){if(sr(t),3==t.G){var e=t.V++,n=en(t.F);an(n,"SID",t.J),an(n,"RID",e),an(n,"TYPE","terminate"),hr(t,n),(e=new xe(t,t.h,e,void 0)).K=2,e.v=un(en(n)),n=!1,C.navigator&&C.navigator.sendBeacon&&(n=C.navigator.sendBeacon(e.v.toString(),"")),!n&&C.Image&&((new Image).src=e.v,n=!0),n||(e.g=Tr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Ke(e)}wr(t)}function or(t){t.g&&(pr(t),t.g.cancel(),t.g=null)}function sr(t){or(t),t.u&&(C.clearTimeout(t.u),t.u=null),gr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&C.clearTimeout(t.m),t.m=null)}function ar(t,e){t.l.push(new En(t.Za++,e)),3==t.G&&ur(t)}function ur(t){Sn(t.i)||t.m||(t.m=!0,te(t.Ha,t),t.C=0)}function cr(t,e){var n;n=e?e.m:t.V++;var r=en(t.F);an(r,"SID",t.J),an(r,"RID",n),an(r,"AID",t.U),hr(t,r),t.o&&t.s&&er(r,t.o,t.s),n=new xe(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=lr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Dn(t.i,n),Me(n,r,e)}function hr(t,e){t.j&&Ye({},function(t,n){an(e,n,t)})}function lr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?V(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{Rn(h,s,"req"+c+"_")}catch(ni){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function fr(t){t.g||t.u||(t.Y=1,te(t.Ga,t),t.A=0)}function dr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Ee(V(t.Ga,t),mr(t,t.A)),t.A++,0))}function pr(t){null!=t.B&&(C.clearTimeout(t.B),t.B=null)}function yr(t){t.g=new xe(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=en(t.oa);an(e,"RID","rpc"),an(e,"SID",t.J),an(e,"CI",t.N?"0":"1"),an(e,"AID",t.U),hr(t,e),an(e,"TYPE","xmlhttp"),t.o&&t.s&&er(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=un(en(e)),n.s=null,n.U=!0,qe(n,t)}function gr(t){null!=t.v&&(C.clearTimeout(t.v),t.v=null)}function vr(t,e){var n=null;if(t.g==e){gr(t),pr(t),t.g=null;var r=2}else{if(!Nn(t.i,e))return;n=e.D,jn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;zt(r=ve(),new Te(r,n,e,i)),ur(t)}else fr(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(An(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Ee(V(t.Ha,t,e),mr(t,t.C)),t.C++,0)))}(t,e)||2==r&&dr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:br(t,5);break;case 4:br(t,10);break;case 3:br(t,6);break;default:br(t,2)}}function mr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function br(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=V(t.jb,t);n||(n=new tn("//www.google.com/images/cleardot.gif"),C.location&&"http"==C.location.protocol||nn(n,"https"),un(n)),function(t,e){var n=new de;if(C.Image){var r=new Image;r.onload=U(Pn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=U(Pn,n,r,"TestLoadImage: error",!1,e),r.onabort=U(Pn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=U(Pn,n,r,"TestLoadImage: timeout",!1,e),C.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else Ie(2);t.G=0,t.j&&t.j.va(e),wr(t),sr(t)}function wr(t){t.G=0,t.I=-1,t.j&&(0==kn(t.i).length&&0==t.l.length||(t.i.i.length=0,H(t.l),t.l.length=0),t.j.ua())}function Ir(t,e,n){var r=function(t){return t instanceof tn?en(t):new tn(t,void 0)}(n);if(""!=r.i)e&&rn(r,e+"."+r.i),on(r,r.m);else{var i=C.location;r=function(t,e,n,r){var i=new tn(null,void 0);return t&&nn(i,t),e&&rn(i,e),n&&on(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&nt(t.aa,function(t,e){an(r,e,t)}),n=t.sa,(e=t.D)&&n&&an(r,e,n),an(r,"VER",t.ma),hr(t,r),r}function Tr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Kn(n&&t.Ba&&!t.qa?new Ln({ib:!0}):t.qa)).L=t.H,e}function Er(){}function _r(){if(ht&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function Or(t,e){Gt.call(this),this.g=new rr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!Y(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Y(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Nr(this)}function Sr(t){je.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Ar(){ke.call(this),this.status=1}function Nr(t){this.g=t}(D=Kn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ne.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:Ne),this.g.onreadystatechange=V(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void Hn(this,o)}t=n||"";var i=new Xe(this.headers);r&&Ye(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Wn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=C.FormData&&t instanceof C.FormData,!(0<=z(Qn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Jn(this),0<this.B&&((this.K=function(t){return ht&&function(){return t=bt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=$(String(at)).split("."),n=$("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Z(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Z(0==o[2].length,0==s[2].length)||Z(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=V(this.pa,this)):this.A=se(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){Hn(this,o)}},D.pa=function(){void 0!==k&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,zt(this,"timeout"),this.abort(8))},D.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,zt(this,"complete"),zt(this,"abort"),$n(this))},D.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),$n(this,!0)),Kn.Z.M.call(this)},D.Fa=function(){this.s||(this.F||this.v||this.l?Xn(this):this.cb())},D.cb=function(){Xn(this)},D.ba=function(){try{return 2<Zn(this)?this.g.status:-1}catch(ut){return-1}},D.ga=function(){try{return this.g?this.g.responseText:""}catch(ut){return""}},D.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Bn(e)}},D.Da=function(){return this.m},D.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(D=rr.prototype).ma=8,D.G=1,D.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},D.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new xe(this,this.h,t,void 0),n=this.s;if(this.P&&(n?ot(n=rt(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=lr(this,e,r),an(i=en(this.F),"RID",t),an(i,"CVER",22),this.D&&an(i,"X-HTTP-Session-Id",this.D),hr(this,i),this.o&&n&&er(i,this.o,n),Dn(this.i,e),this.Ra&&an(i,"TYPE","init"),this.ja?(an(i,"$req",r),an(i,"SID","null"),e.$=!0,Me(e,i,null)):Me(e,i,r),this.G=2}}else 3==this.G&&(t?cr(this,t):0==this.l.length||Sn(this.i)||cr(this))},D.Ga=function(){if(this.u=null,yr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Ee(V(this.bb,this),t)}},D.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Ie(10),or(this),yr(this))},D.ab=function(){null!=this.v&&(this.v=null,or(this),dr(this),Ie(19))},D.jb=function(t){t?(this.h.info("Successfully pinged google.com"),Ie(2)):(this.h.info("Failed to ping google.com"),Ie(1))},(D=Er.prototype).xa=function(){},D.wa=function(){},D.va=function(){},D.ua=function(){},D.Oa=function(){},_r.prototype.g=function(t,e){return new Or(t,e)},B(Or,Gt),Or.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),te(V(t.hb,t,e))),Ie(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Ir(t,null,t.W),ur(t)},Or.prototype.close=function(){ir(this.g)},Or.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,ar(this.g,e)}else this.v?((e={}).__data__=Wt(t),ar(this.g,e)):ar(this.g,t)},Or.prototype.M=function(){this.g.j=null,delete this.j,ir(this.g),delete this.g,Or.Z.M.call(this)},B(Sr,je),B(Ar,ke),B(Nr,Er),Nr.prototype.xa=function(){zt(this.g,"a")},Nr.prototype.wa=function(t){zt(this.g,new Sr(t))},Nr.prototype.va=function(t){zt(this.g,new Ar(t))},Nr.prototype.ua=function(){zt(this.g,"b")},_r.prototype.createWebChannel=_r.prototype.g,Or.prototype.send=Or.prototype.u,Or.prototype.open=Or.prototype.m,Or.prototype.close=Or.prototype.close,_e.NO_ERROR=0,_e.TIMEOUT=8,_e.HTTP_ERROR=6,Oe.COMPLETE="complete",Ae.EventType=De,De.OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",Gt.prototype.listen=Gt.prototype.N,Kn.prototype.listenOnce=Kn.prototype.O,Kn.prototype.getLastError=Kn.prototype.La,Kn.prototype.getLastErrorCode=Kn.prototype.Da,Kn.prototype.getStatus=Kn.prototype.ba,Kn.prototype.getResponseJson=Kn.prototype.Qa,Kn.prototype.getResponseText=Kn.prototype.ga,Kn.prototype.send=Kn.prototype.ea;var Dr=_e,jr=Oe,kr=ye,Cr=Ln,xr=Ae,Rr=Kn,Pr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Pr.o=-1;var Lr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Fr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(_.c)(e,t),e}(Error),Mr=new S.b("@firebase/firestore");function qr(){return Mr.logLevel}function Vr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Mr.logLevel<=S.a.DEBUG){var r=e.map(Kr);Mr.debug.apply(Mr,Object(_.f)(["Firestore (8.7.0): "+t],r))}}function Ur(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Mr.logLevel<=S.a.ERROR){var r=e.map(Kr);Mr.error.apply(Mr,Object(_.f)(["Firestore (8.7.0): "+t],r))}}function Br(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Mr.logLevel<=S.a.WARN){var r=e.map(Kr);Mr.warn.apply(Mr,Object(_.f)(["Firestore (8.7.0): "+t],r))}}function Kr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Kd){return t}}function Gr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.7.0) INTERNAL ASSERTION FAILED: "+t;throw Ur(e),new Error(e)}function zr(t,e){t||Gr()}function Qr(t,e){return t}function Wr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Hr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Wr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Yr(t,e){return t<e?-1:t>e?1:0}function Xr(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function $r(t){return t+"\0"}var Jr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Fr(Lr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Fr(Lr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Fr(Lr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Fr(Lr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Yr(this.nanoseconds,t.nanoseconds):Yr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Zr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Jr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function ti(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ei(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ni(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var ri=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Gr(),void 0===n?n=t.length-e:n>t.length-e&&Gr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ii=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(ri),oi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,si=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return oi.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Fr(Lr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Fr(Lr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Fr(Lr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(ri),ai=function(){function t(t){this.fields=t,t.sort(si.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Xr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),ui=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Yr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();ui.EMPTY_BYTE_STRING=new ui("");var ci=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hi(t){if(zr(!!t),"string"==typeof t){var e=0,n=ci.exec(t);if(zr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:li(t.seconds),nanos:li(t.nanos)}}function li(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function fi(t){return"string"==typeof t?ui.fromBase64String(t):ui.fromUint8Array(t)}function di(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function pi(t){var e=t.mapValue.fields.__previous_value__;return di(e)?pi(e):e}function yi(t){var e=hi(t.mapValue.fields.__local_write_time__.timestampValue);return new Jr(e.seconds,e.nanos)}function gi(t){return null==t}function vi(t){return 0===t&&1/t==-1/0}function mi(t){return"number"==typeof t&&Number.isInteger(t)&&!vi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var bi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(ii.fromString(e))},t.fromName=function(e){return new t(ii.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ii.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return ii.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new ii(e.slice()))},t}();function wi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?di(t)?4:10:Gr()}function Ii(t,e){var n=wi(t);if(n!==wi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return yi(t).isEqual(yi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=hi(t.timestampValue),r=hi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return fi(t.bytesValue).isEqual(fi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return li(t.geoPointValue.latitude)===li(e.geoPointValue.latitude)&&li(t.geoPointValue.longitude)===li(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return li(t.integerValue)===li(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=li(t.doubleValue),r=li(e.doubleValue);return n===r?vi(n)===vi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Xr(t.arrayValue.values||[],e.arrayValue.values||[],Ii);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ti(n)!==ti(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ii(n[i],r[i])))return!1;return!0}(t,e);default:return Gr()}}function Ti(t,e){return void 0!==(t.values||[]).find(function(t){return Ii(t,e)})}function Ei(t,e){var n=wi(t),r=wi(e);if(n!==r)return Yr(n,r);switch(n){case 0:return 0;case 1:return Yr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=li(t.integerValue||t.doubleValue),r=li(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return _i(t.timestampValue,e.timestampValue);case 4:return _i(yi(t),yi(e));case 5:return Yr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=fi(t),r=fi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Yr(n[i],r[i]);if(0!==o)return o}return Yr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Yr(li(t.latitude),li(e.latitude));return 0!==n?n:Yr(li(t.longitude),li(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ei(n[i],r[i]);if(o)return o}return Yr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Yr(r[s],o[s]);if(0!==a)return a;var u=Ei(n[r[s]],i[o[s]]);if(0!==u)return u}return Yr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Gr()}}function _i(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Yr(t,e);var n=hi(t),r=hi(e),i=Yr(n.seconds,r.seconds);return 0!==i?i:Yr(n.nanos,r.nanos)}function Oi(t){return Si(t)}function Si(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=hi(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?fi(t.bytesValue).toBase64():"referenceValue"in t?bi.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Si(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Si(t.fields[o])}return e+"}"}(t.mapValue):Gr();var e}function Ai(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ni(t){return!!t&&"integerValue"in t}function Di(t){return!!t&&"arrayValue"in t}function ji(t){return!!t&&"nullValue"in t}function ki(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ci(t){return!!t&&"mapValue"in t}function xi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},hi(t.timestampValue))};if(t.mapValue){var e={mapValue:{fields:{}}};return ei(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=xi(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=xi(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Ri=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Ci(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=xi(e)},t.prototype.setAll=function(t){var e=this,n=si.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=xi(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Ci(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return Ii(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Ci(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){ei(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(xi(this.value))},t}();function Pi(t){var e=[];return ei(t.fields,function(t,n){var r=new si([t]);if(Ci(n)){var i=Pi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new ai(e)}var Li=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Zr.min(),Ri.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Ri.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Ri.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ri.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ri.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Fi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Mi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Fi(t,e,n,r,i,o,s)}function qi(t){var e=Qr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Oi(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),gi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Ji(e.startAt)),e.endAt&&(n+="|ub:",n+=Ji(e.endAt)),e.h=n}return e.h}function Vi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!to(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!Ii(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!no(t.startAt,e.startAt)&&no(t.endAt,e.endAt)}function Ui(t){return bi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Bi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(_.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Ki(t,n,r):"array-contains"===n?new Wi(t,r):"in"===n?new Hi(t,r):"not-in"===n?new Yi(t,r):"array-contains-any"===n?new Xi(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Gi(t,n):new zi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Ei(e,this.value)):null!==e&&wi(this.value)===wi(e)&&this.m(Ei(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Gr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Ki=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=bi.fromName(r.referenceValue),i}return Object(_.c)(e,t),e.prototype.matches=function(t){var e=bi.comparator(t.key,this.key);return this.m(e)},e}(Bi),Gi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Qi(0,n),r}return Object(_.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(Bi),zi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Qi(0,n),r}return Object(_.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(Bi);function Qi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return bi.fromName(t.referenceValue)})}var Wi=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(_.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Di(e)&&Ti(e.arrayValue,this.value)},e}(Bi),Hi=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(_.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Ti(this.value.arrayValue,e)},e}(Bi),Yi=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(_.c)(e,t),e.prototype.matches=function(t){if(Ti(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Ti(this.value.arrayValue,e)},e}(Bi),Xi=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(_.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Di(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Ti(e.value.arrayValue,t)})},e}(Bi),$i=function(t,e){this.position=t,this.before=e};function Ji(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Oi(t)}).join(",")}var Zi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function to(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function eo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?bi.comparator(bi.fromName(s.referenceValue),n.key):Ei(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function no(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ii(t.position[n],e.position[n]))return!1;return!0}var ro=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function io(t,e,n,r,i,o,s,a){return new ro(t,e,n,r,i,o,s,a)}function oo(t){return new ro(t)}function so(t){return!gi(t.limit)&&"F"===t.limitType}function ao(t){return!gi(t.limit)&&"L"===t.limitType}function uo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function co(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function ho(t){return null!==t.collectionGroup}function lo(t){var e=Qr(t);if(null===e.p){e.p=[];var n=co(e),r=uo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Zi(n)),e.p.push(new Zi(si.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Zi(si.keyField(),u))}}}return e.p}function fo(t){var e=Qr(t);if(!e.T)if("F"===e.limitType)e.T=Mi(e.path,e.collectionGroup,lo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=lo(e);r<i.length;r++){var o=i[r];n.push(new Zi(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new $i(e.endAt.position,!e.endAt.before):null,a=e.startAt?new $i(e.startAt.position,!e.startAt.before):null;e.T=Mi(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function po(t,e,n){return new ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function yo(t,e){return Vi(fo(t),fo(e))&&t.limitType===e.limitType}function go(t){return qi(fo(t))+"|lt:"+t.limitType}function vo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Oi(e.value);var e}).join(", ")+"]"),gi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Ji(t.startAt)),t.endAt&&(e+=", endAt: "+Ji(t.endAt)),"Target("+e+")"}(fo(t))+"; limitType="+t.limitType+")"}function mo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):bi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!eo(t.startAt,lo(t),e)||t.endAt&&eo(t.endAt,lo(t),e))}(t,e)}function bo(t){return function(e,n){for(var r=!1,i=0,o=lo(t);i<o.length;i++){var s=o[i],a=wo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function wo(t,e,n){var r=t.field.isKeyField()?bi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Ei(r,i):Gr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Gr()}}function Io(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vi(e)?"-0":e}}function To(t){return{integerValue:""+t}}function Eo(t,e){return mi(e)?To(e):Io(t,e)}var _o=function(){this._=void 0};function Oo(t,e,n){return t instanceof No?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Do?jo(t,e):t instanceof ko?Co(t,e):function(t,e){var n=Ao(t,e),r=Ro(n)+Ro(t.A);return Ni(n)&&Ni(t.A)?To(r):Io(t.R,r)}(t,e)}function So(t,e,n){return t instanceof Do?jo(t,e):t instanceof ko?Co(t,e):n}function Ao(t,e){return t instanceof xo?Ni(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var No=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.c)(e,t),e}(_o),Do=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(_.c)(e,t),e}(_o);function jo(t,e){for(var n=Po(e),r=function(t){n.some(function(e){return Ii(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ko=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(_.c)(e,t),e}(_o);function Co(t,e){for(var n=Po(e),r=function(t){n=n.filter(function(e){return!Ii(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var xo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(_.c)(e,t),e}(_o);function Ro(t){return li(t.integerValue||t.doubleValue)}function Po(t){return Di(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Lo=function(t,e){this.field=t,this.transform=e},Fo=function(t,e){this.version=t,this.transformResults=e},Mo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function qo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Vo=function(){};function Uo(t,e,n){t instanceof Qo?function(t,e,n){var r=t.value.clone(),i=Yo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Wo?function(t,e,n){if(qo(t.precondition,e)){var r=Yo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Ho(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Bo(t,e,n){t instanceof Qo?function(t,e,n){if(qo(t.precondition,e)){var r=t.value.clone(),i=Xo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(zo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Wo?function(t,e,n){if(qo(t.precondition,e)){var r=Xo(t.fieldTransforms,n,e),i=e.data;i.setAll(Ho(t)),i.setAll(r),e.convertToFoundDocument(zo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){qo(t.precondition,e)&&e.convertToNoDocument(Zr.min())}(t,e)}function Ko(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Ao(o.transform,s||null);null!=a&&(null==n&&(n=Ri.empty()),n.set(o.field,a))}return n||null}function Go(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Xr(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Do&&e instanceof Do||t instanceof ko&&e instanceof ko?Xr(t.elements,e.elements,Ii):t instanceof xo&&e instanceof xo?Ii(t.A,e.A):t instanceof No&&e instanceof No}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function zo(t){return t.isFoundDocument()?t.version:Zr.min()}var Qo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(_.c)(e,t),e}(Vo),Wo=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(_.c)(e,t),e}(Vo);function Ho(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function Yo(t,e,n){var r=new Map;zr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,So(s,a,n[i]))}return r}function Xo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Oo(a,u,e))}return r}var $o,Jo,Zo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(_.c)(e,t),e}(Vo),ts=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(_.c)(e,t),e}(Vo),es=function(t){this.count=t};function ns(t){switch(t){case Lr.OK:return Gr();case Lr.CANCELLED:case Lr.UNKNOWN:case Lr.DEADLINE_EXCEEDED:case Lr.RESOURCE_EXHAUSTED:case Lr.INTERNAL:case Lr.UNAVAILABLE:case Lr.UNAUTHENTICATED:return!1;case Lr.INVALID_ARGUMENT:case Lr.NOT_FOUND:case Lr.ALREADY_EXISTS:case Lr.PERMISSION_DENIED:case Lr.FAILED_PRECONDITION:case Lr.ABORTED:case Lr.OUT_OF_RANGE:case Lr.UNIMPLEMENTED:case Lr.DATA_LOSS:return!0;default:return Gr()}}function rs(t){if(void 0===t)return Ur("GRPC error has no .code"),Lr.UNKNOWN;switch(t){case $o.OK:return Lr.OK;case $o.CANCELLED:return Lr.CANCELLED;case $o.UNKNOWN:return Lr.UNKNOWN;case $o.DEADLINE_EXCEEDED:return Lr.DEADLINE_EXCEEDED;case $o.RESOURCE_EXHAUSTED:return Lr.RESOURCE_EXHAUSTED;case $o.INTERNAL:return Lr.INTERNAL;case $o.UNAVAILABLE:return Lr.UNAVAILABLE;case $o.UNAUTHENTICATED:return Lr.UNAUTHENTICATED;case $o.INVALID_ARGUMENT:return Lr.INVALID_ARGUMENT;case $o.NOT_FOUND:return Lr.NOT_FOUND;case $o.ALREADY_EXISTS:return Lr.ALREADY_EXISTS;case $o.PERMISSION_DENIED:return Lr.PERMISSION_DENIED;case $o.FAILED_PRECONDITION:return Lr.FAILED_PRECONDITION;case $o.ABORTED:return Lr.ABORTED;case $o.OUT_OF_RANGE:return Lr.OUT_OF_RANGE;case $o.UNIMPLEMENTED:return Lr.UNIMPLEMENTED;case $o.DATA_LOSS:return Lr.DATA_LOSS;default:return Gr()}}(Jo=$o||($o={}))[Jo.OK=0]="OK",Jo[Jo.CANCELLED=1]="CANCELLED",Jo[Jo.UNKNOWN=2]="UNKNOWN",Jo[Jo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Jo[Jo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Jo[Jo.NOT_FOUND=5]="NOT_FOUND",Jo[Jo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Jo[Jo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Jo[Jo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Jo[Jo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Jo[Jo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Jo[Jo.ABORTED=10]="ABORTED",Jo[Jo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Jo[Jo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Jo[Jo.INTERNAL=13]="INTERNAL",Jo[Jo.UNAVAILABLE=14]="UNAVAILABLE",Jo[Jo.DATA_LOSS=15]="DATA_LOSS";var is=function(){function t(t,e){this.comparator=t,this.root=e||ss.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ss.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ss.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new os(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new os(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new os(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new os(this.root,t,this.comparator,!0)},t}(),os=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),ss=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Gr();if(this.right.isRed())throw Gr();var t=this.left.check();if(t!==this.right.check())throw Gr();return t+(this.isRed()?0:1)},t}();ss.EMPTY=null,ss.RED=!0,ss.BLACK=!1,ss.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Gr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Gr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Gr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Gr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Gr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new ss(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var as=function(){function t(t){this.comparator=t,this.data=new is(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new us(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new us(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),us=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),cs=new is(bi.comparator);function hs(){return cs}var ls=new is(bi.comparator);function fs(){return ls}var ds=new is(bi.comparator);function ps(){return ds}var ys=new as(bi.comparator);function gs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ys,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var vs=new as(Yr);function ms(){return vs}var bs=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ws.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Zr.min(),r,ms(),hs(),gs())},t}(),ws=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(ui.EMPTY_BYTE_STRING,n,gs(),gs(),gs())},t}(),Is=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Ts=function(t,e){this.targetId=t,this.V=e},Es=function(t,e,n,r){void 0===n&&(n=ui.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},_s=function(){function t(){this.S=0,this.D=As(),this.C=ui.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=gs(),e=gs(),n=gs();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Gr()}}),new ws(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=As()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Os=function(){function t(t){this.W=t,this.G=new Map,this.H=hs(),this.J=Ss(),this.Y=new as(Yr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Gr()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Ui(i))if(0===n){var o=new bi(i.path);this.tt(e,o,Li.newNoDocument(o,Zr.min()))}else zr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Ui(o.target)){var s=new bi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Li.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=gs();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new bs(t,n,this.Y,this.H,r);return this.H=hs(),this.J=Ss(),this.Y=new as(Yr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new _s,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new as(Yr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Vr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new _s),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Ss(){return new is(bi.comparator)}function As(){return new is(bi.comparator)}var Ns={asc:"ASCENDING",desc:"DESCENDING"},Ds={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},js=function(t,e){this.databaseId=t,this.I=e};function ks(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Cs(t,e){return t.I?e.toBase64():e.toUint8Array()}function xs(t,e){return ks(t,e.toTimestamp())}function Rs(t){return zr(!!t),Zr.fromTimestamp(function(t){var e=hi(t);return new Jr(e.seconds,e.nanos)}(t))}function Ps(t,e){return function(t){return new ii(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ls(t){var e=ii.fromString(t);return zr(sa(e)),e}function Fs(t,e){return Ps(t.databaseId,e.path)}function Ms(t,e){var n=Ls(e);if(n.get(1)!==t.databaseId.projectId)throw new Fr(Lr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Fr(Lr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new bi(Bs(n))}function qs(t,e){return Ps(t.databaseId,e)}function Vs(t){var e=Ls(t);return 4===e.length?ii.emptyPath():Bs(e)}function Us(t){return new ii(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Bs(t){return zr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ks(t,e,n){return{name:Fs(t,e),fields:n.value.mapValue.fields}}function Gs(t,e,n){var r=Ms(t,e.name),i=Rs(e.updateTime),o=new Ri({mapValue:{fields:e.fields}}),s=Li.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function zs(t,e){var n;if(e instanceof Qo)n={update:Ks(t,e.key,e.value)};else if(e instanceof Zo)n={delete:Fs(t,e.key)};else if(e instanceof Wo)n={update:Ks(t,e.key,e.data),updateMask:oa(e.fieldMask)};else{if(!(e instanceof ts))return Gr();n={verify:Fs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof No)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Do)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ko)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof xo)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Gr()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:xs(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Gr()}(t,e.precondition)),n}function Qs(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Mo.updateTime(Rs(t.updateTime)):void 0!==t.exists?Mo.exists(t.exists):Mo.none()}(e.currentDocument):Mo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(zr("REQUEST_TIME"===e.setToServerValue),n=new No):"appendMissingElements"in e?n=new Do(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new ko(e.removeAllFromArray.values||[]):"increment"in e?n=new xo(t,e.increment):Gr();var r=si.fromServerFormat(e.fieldPath);return new Lo(r,n)}(t,e)}):[];if(e.update){var i=Ms(t,e.update.name),o=new Ri({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new ai((t.fieldPaths||[]).map(function(t){return si.fromServerFormat(t)}))}(e.updateMask);return new Wo(i,o,s,n,r)}return new Qo(i,o,n,r)}if(e.delete){var a=Ms(t,e.delete);return new Zo(a,n)}if(e.verify){var u=Ms(t,e.verify);return new ts(u,n)}return Gr()}function Ws(t,e){return{documents:[qs(t,e.path)]}}function Hs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=qs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=qs(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(ki(t.value))return{unaryFilter:{field:ea(t.field),op:"IS_NAN"}};if(ji(t.value))return{unaryFilter:{field:ea(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ki(t.value))return{unaryFilter:{field:ea(t.field),op:"IS_NOT_NAN"}};if(ji(t.value))return{unaryFilter:{field:ea(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ea(t.field),op:ta(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:ea(t.field),direction:Zs(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||gi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=$s(e.startAt)),e.endAt&&(n.structuredQuery.endAt=$s(e.endAt)),n}function Ys(t){var e=Vs(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){zr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Xs(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new Zi(na(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return gi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Js(n.startAt));var h=null;return n.endAt&&(h=Js(n.endAt)),io(e,i,a,s,u,"F",c,h)}function Xs(t){return t?void 0!==t.unaryFilter?[ia(t)]:void 0!==t.fieldFilter?[ra(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Xs(t)}).reduce(function(t,e){return t.concat(e)}):Gr():[]}function $s(t){return{before:t.before,values:t.position}}function Js(t){return new $i(t.values||[],!!t.before)}function Zs(t){return Ns[t]}function ta(t){return Ds[t]}function ea(t){return{fieldPath:t.canonicalString()}}function na(t){return si.fromServerFormat(t.fieldPath)}function ra(t){return Bi.create(na(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Gr()}}(t.fieldFilter.op),t.fieldFilter.value)}function ia(t){switch(t.unaryFilter.op){case"IS_NAN":var e=na(t.unaryFilter.field);return Bi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=na(t.unaryFilter.field);return Bi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=na(t.unaryFilter.field);return Bi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=na(t.unaryFilter.field);return Bi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Gr()}}function oa(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function sa(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function aa(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ca(e)),e=ua(t.get(n),e);return ca(e)}function ua(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function ca(t){return t+"\x01\x01"}function ha(t){var e=t.length;if(zr(e>=2),2===e)return zr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),ii.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Gr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Gr()}o=s+2}return new ii(r)}var la=function(t,e){this.seconds=t,this.nanoseconds=e},fa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};fa.store="owner",fa.key="owner";var da=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};da.store="mutationQueues",da.keyPath="userId";var pa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};pa.store="mutations",pa.keyPath="batchId",pa.userMutationsIndex="userMutationsIndex",pa.userMutationsKeyPath=["userId","batchId"];var ya=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,aa(e)]},t.key=function(t,e,n){return[t,aa(e),n]},t}();ya.store="documentMutations",ya.PLACEHOLDER=new ya;var ga=function(t,e){this.path=t,this.readTime=e},va=function(t,e){this.path=t,this.version=e},ma=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ma.store="remoteDocuments",ma.readTimeIndex="readTimeIndex",ma.readTimeIndexPath="readTime",ma.collectionReadTimeIndex="collectionReadTimeIndex",ma.collectionReadTimeIndexPath=["parentPath","readTime"];var ba=function(t){this.byteSize=t};ba.store="remoteDocumentGlobal",ba.key="remoteDocumentGlobalKey";var wa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};wa.store="targets",wa.keyPath="targetId",wa.queryTargetsIndexName="queryTargetsIndex",wa.queryTargetsKeyPath=["canonicalId","targetId"];var Ia=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ia.store="targetDocuments",Ia.keyPath=["targetId","path"],Ia.documentTargetsIndex="documentTargetsIndex",Ia.documentTargetsKeyPath=["path","targetId"];var Ta=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ta.key="targetGlobalKey",Ta.store="targetGlobal";var Ea=function(t,e){this.collectionId=t,this.parent=e};Ea.store="collectionParents",Ea.keyPath=["collectionId","parent"];var _a=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};_a.store="clientMetadata",_a.keyPath="clientId";var Oa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Oa.store="bundles",Oa.keyPath="bundleId";var Sa=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Sa.store="namedQueries",Sa.keyPath="name";var Aa=Object(_.f)(Object(_.f)([],Object(_.f)(Object(_.f)([],Object(_.f)(Object(_.f)([],Object(_.f)(Object(_.f)([],[da.store,pa.store,ya.store,ma.store,wa.store,fa.store,Ta.store,Ia.store]),[_a.store])),[ba.store])),[Ea.store])),[Oa.store,Sa.store]),Na="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Da=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),ja=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},ka=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Gr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Ca=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new ja,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Pa(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Va(e.target.error);n.ft.reject(new Pa(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Pa(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Vr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Fa(e)},t}(),xa=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(O.j)())&&Ur("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Vr("SimpleDb","Removing database:",t),Ma(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(O.j)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(_.b)(this,void 0,void 0,function(){var e,n=this;return Object(_.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Vr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Pa(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Fr(Lr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Pa(t,n))},i.onupgradeneeded=function(t){Vr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Vr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(_.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(_.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(_.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Ca.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),ka.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Vr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Ra=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Ma(this.Pt.delete())},t}(),Pa=function(t){function e(e,n){var r=this;return(r=t.call(this,Lr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(_.c)(e,t),e}(Fr);function La(t){return"IndexedDbTransactionError"===t.name}var Fa=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Vr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Vr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ma(n)},t.prototype.add=function(t){return Vr("SimpleDb","ADD",this.store.name,t,t),Ma(this.store.add(t))},t.prototype.get=function(t){var e=this;return Ma(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Vr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Vr("SimpleDb","DELETE",this.store.name,t),Ma(this.store.delete(t))},t.prototype.count=function(){return Vr("SimpleDb","COUNT",this.store.name),Ma(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Vr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new ka(function(n,r){e.onerror=function(t){var e=Va(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new ka(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Ra(i),s=e(i.primaryKey,i.value,o);if(s instanceof ka){var a=s.catch(function(t){return o.done(),ka.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return ka.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Ma(t){return new ka(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Va(t.target.error);n(e)}})}var qa=!1;function Va(t){var e=xa._t(Object(O.j)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Fr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return qa||(qa=!0,setTimeout(function(){throw r},0)),r}}return t}var Ua=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(_.c)(e,t),e}(Da);function Ba(t,e){var n=Qr(t);return xa.It(n.Mt,e)}var Ka=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Uo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Bo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Bo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Zr.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},gs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Xr(this.mutations,t.mutations,function(t,e){return Go(t,e)})&&Xr(this.baseMutations,t.baseMutations,function(t,e){return Go(t,e)})},t}(),Ga=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){zr(e.mutations.length===r.length);for(var i=ps(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),za=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Zr.min()),void 0===o&&(o=Zr.min()),void 0===s&&(s=ui.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Qa=function(t){this.Lt=t};function Wa(t,e){if(e.document)return Gs(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=bi.fromSegments(e.noDocument.path),r=Ja(e.noDocument.readTime),i=Li.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=bi.fromSegments(e.unknownDocument.path);return r=Ja(e.unknownDocument.version),Li.newUnknownDocument(o,r)}return Gr()}function Ha(t,e,n){var r=Ya(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Fs(t,e.key),fields:e.data.value.mapValue.fields,updateTime:ks(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new ma(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=$a(e.version);return s=e.hasCommittedMutations,new ma(null,new ga(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=$a(e.version);return new ma(new va(c,h),null,null,!0,r,i)}return Gr()}function Ya(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Xa(t){var e=new Jr(t[0],t[1]);return Zr.fromTimestamp(e)}function $a(t){var e=t.toTimestamp();return new la(e.seconds,e.nanoseconds)}function Ja(t){var e=new Jr(t.seconds,t.nanoseconds);return Zr.fromTimestamp(e)}function Za(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Qs(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return Qs(t.Lt,e)}),o=Jr.fromMillis(e.localWriteTimeMs);return new Ka(e.batchId,o,n,i)}function tu(t){var e,n,r=Ja(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ja(t.lastLimboFreeSnapshotVersion):Zr.min();return void 0!==t.query.documents?(zr(1===(n=t.query).documents.length),e=fo(oo(Vs(n.documents[0])))):e=function(t){return fo(Ys(t))}(t.query),new za(e,t.targetId,0,t.lastListenSequenceNumber,r,i,ui.fromBase64String(t.resumeToken))}function eu(t,e){var n,r=$a(e.snapshotVersion),i=$a(e.lastLimboFreeSnapshotVersion);n=Ui(e.target)?Ws(t.Lt,e.target):Hs(t.Lt,e.target);var o=e.resumeToken.toBase64();return new wa(e.targetId,qi(e.target),r,o,e.sequenceNumber,i,n)}function nu(t){var e=Ys({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?po(e,e.limit,"L"):e}var ru=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return iu(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Ja(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return iu(t).put({bundleId:(n=e).id,createTime:$a(Rs(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return ou(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:nu(e.bundledQuery),readTime:Ja(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return ou(t).put(function(t){return{name:t.name,readTime:$a(Rs(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function iu(t){return Ba(t,Oa.store)}function ou(t){return Ba(t,Sa.store)}var su=function(){function t(){this.Bt=new au}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),ka.resolve()},t.prototype.getCollectionParents=function(t,e){return ka.resolve(this.Bt.getEntries(e))},t}(),au=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new as(ii.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new as(ii.comparator)).toArray()},t}(),uu=function(){function t(){this.qt=new au}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:aa(i)};return cu(t).put(o)}return ka.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[$r(e),""],!1,!0);return cu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ha(o.parent))}return n})},t}();function cu(t){return Ba(t,Ea.store)}var hu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},lu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function fu(t,e,n){var r=t.store(pa.store),i=t.store(ya.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){zr(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=ya.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return ka.waitFor(o).next(function(){return c})}function du(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Gr();e=t.noDocument}return JSON.stringify(e).length}lu.DEFAULT_COLLECTION_PERCENTILE=10,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lu.DEFAULT=new lu(41943040,lu.DEFAULT_COLLECTION_PERCENTILE,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lu.DISABLED=new lu(-1,0,0);var pu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return zr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return gu(t).$t({index:pa.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=vu(t),s=gu(t);return s.add({}).next(function(a){zr("number"==typeof a);for(var u=new Ka(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return zs(t.Lt,e)}),i=n.mutations.map(function(e){return zs(t.Lt,e)});return new pa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new as(function(t,e){return Yr(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],y=ya.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,ya.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),ka.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return gu(t).get(e).next(function(t){return t?(zr(t.userId===n.userId),Za(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?ka.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return gu(t).$t({index:pa.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(zr(e.batchId>=r),o=Za(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return gu(t).$t({index:pa.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return gu(t).Nt(pa.userMutationsIndex,n).next(function(t){return t.map(function(t){return Za(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=ya.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return vu(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=ha(r[1]);if(a===n.userId&&e.path.isEqual(c))return gu(t).get(u).next(function(t){if(!t)throw Gr();zr(t.userId===n.userId),o.push(Za(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new as(Yr),i=[];return e.forEach(function(e){var o=ya.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=vu(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=ha(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),ka.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=ya.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new as(Yr);return vu(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=ha(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(gu(t).get(e).next(function(t){if(null===t)throw Gr();zr(t.userId===n.userId),r.push(Za(n.R,t))}))}),ka.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return fu(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),ka.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return ka.resolve();var r=IDBKeyRange.lowerBound(ya.prefixForUser(e.userId)),i=[];return vu(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=ha(t[1]);i.push(o)}else r.done()}).next(function(){zr(0===i.length)})})},t.prototype.containsKey=function(t,e){return yu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return mu(t).get(this.userId).next(function(t){return t||new da(e.userId,-1,"")})},t}();function yu(t,e,n){var r=ya.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return vu(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function gu(t){return Ba(t,pa.store)}function vu(t){return Ba(t,ya.store)}function mu(t){return Ba(t,da.store)}var bu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),wu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new bu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return Zr.fromTimestamp(new Jr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Iu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return zr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Iu(t).$t(function(s,a){var u=tu(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return ka.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return Iu(t).$t(function(t,n){var r=tu(n);e(r)})},t.prototype.Xt=function(t){return Tu(t).get(Ta.key).next(function(t){return zr(null!==t),t})},t.prototype.Zt=function(t,e){return Tu(t).put(Ta.key,e)},t.prototype.te=function(t,e){return Iu(t).put(eu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=qi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Iu(t).$t({range:r,index:wa.queryTargetsIndexName},function(t,n,r){var o=tu(n);Vi(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Eu(t);return e.forEach(function(e){var s=aa(e.path);i.push(o.put(new Ia(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),ka.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Eu(t);return ka.forEach(e,function(e){var o=aa(e.path);return ka.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Eu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Eu(t),i=gs();return r.$t({range:n,kt:!0},function(t,e,n){var r=ha(t[1]),o=new bi(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=aa(e.path),r=IDBKeyRange.bound([n],[$r(n)],!1,!0),i=0;return Eu(t).$t({index:Ia.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return Iu(t).get(e).next(function(t){return t?tu(t):null})},t}();function Iu(t){return Ba(t,wa.store)}function Tu(t){return Ba(t,Ta.store)}function Eu(t){return Ba(t,Ia.store)}function _u(t){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(e){if(t.code!==Lr.FAILED_PRECONDITION||t.message!==Na)throw t;return Vr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Ou(t,e){var n=t[1],r=e[1],i=Yr(t[0],e[0]);return 0===i?Yr(n,r):i}var Su=function(){function t(t){this.ne=t,this.buffer=new as(Ou),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Ou(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Au=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Vr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(_.b)(e,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return La(e=n.sent())?(Vr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,_u(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Nu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return ka.resolve(Pr.o);var r=new Su(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Vr("LruGarbageCollector","Garbage collection skipped; disabled"),ka.resolve(hu)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Vr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),hu):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Vr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),qr()<=S.a.DEBUG&&Vr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),ka.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Du=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Nu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return ju(t,n)},t.prototype.removeReference=function(t,e,n){return ju(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return ju(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return mu(t).Ot(function(r){return yu(t,r,e).next(function(t){return t&&(n=!0),ka.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),Eu(t).delete([0,aa(s.path)])})});i.push(u)}}).next(function(){return ka.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return ju(t,e)},t.prototype.we=function(t,e){var n,r=Eu(t),i=Pr.o;return r.$t({index:Ia.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Pr.o&&e(new bi(ha(n)),i),i=s,n=o):i=Pr.o}).next(function(){i!==Pr.o&&e(new bi(ha(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function ju(t,e){return Eu(t).put(function(t,e){return new Ia(0,aa(t.path),e)}(e,t.currentSequenceNumber))}var ku=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){ei(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return ni(this.inner)},t}(),Cu=function(){function t(){this.changes=new ku(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Zr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Li.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ka.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),xu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Lu(t).put(Fu(e),n)},t.prototype.removeEntry=function(t,e){var n=Lu(t),r=Fu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return Lu(t).get(Fu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return Lu(t).get(Fu(e)).next(function(t){return{document:n.ye(e,t),size:du(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=hs();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=hs(),i=new is(bi.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,du(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return ka.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Lu(t).$t({range:r},function(t,e,r){for(var s=bi.fromSegments(t);o&&bi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=hs(),o=e.path.length+1,s={};if(n.isEqual(Zr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Ya(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=ma.collectionReadTimeIndex}return Lu(t).$t(s,function(t,n,s){if(t.length===o){var a=Wa(r.R,n);e.path.isPrefixOf(a.key.path)?mo(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Ru(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Pu(t).get(ba.key).next(function(t){return zr(!!t),t})},t.prototype.me=function(t,e){return Pu(t).put(ba.key,e)},t.prototype.ye=function(t,e){if(e){var n=Wa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Zr.min()))return n}return Li.newInvalidDocument(t)},t}(),Ru=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new ku(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(_.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new as(function(t,e){return Yr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Ha(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=du(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Ha(e.Ie.R,Li.newNoDocument(o,Zr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),ka.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Cu);function Pu(t){return Ba(t,ba.store)}function Lu(t){return Ba(t,ma.store)}function Fu(t){return t.path.toArray()}var Mu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;zr(n<r&&n>=0&&r<=11);var o=new Ca("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(fa.store)}(t),function(t){t.createObjectStore(da.store,{keyPath:da.keyPath}),t.createObjectStore(pa.store,{keyPath:pa.keyPath,autoIncrement:!0}).createIndex(pa.userMutationsIndex,pa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(ya.store)}(t),qu(t),function(t){t.createObjectStore(ma.store)}(t));var s=ka.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Ia.store),t.deleteObjectStore(wa.store),t.deleteObjectStore(Ta.store)}(t),qu(t)),s=s.next(function(){return function(t){var e=t.store(Ta.store),n=new Ta(0,0,Zr.min().toTimestamp(),0);return e.put(Ta.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(pa.store).Nt().next(function(n){t.deleteObjectStore(pa.store),t.createObjectStore(pa.store,{keyPath:pa.keyPath,autoIncrement:!0}).createIndex(pa.userMutationsIndex,pa.userMutationsKeyPath,{unique:!0});var r=e.store(pa.store),i=n.map(function(t){return r.put(t)});return ka.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(_a.store,{keyPath:_a.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(ba.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ma.store);e.createIndex(ma.readTimeIndex,ma.readTimeIndexPath,{unique:!1}),e.createIndex(ma.collectionReadTimeIndex,ma.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(Oa.store,{keyPath:Oa.keyPath})}(t),function(t){t.createObjectStore(Sa.store,{keyPath:Sa.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(ma.store).$t(function(t,n){e+=du(n)}).next(function(){var n=new ba(e);return t.store(ba.store).put(ba.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(da.store),r=t.store(pa.store);return n.Nt().next(function(n){return ka.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(pa.userMutationsIndex,i).next(function(r){return ka.forEach(r,function(r){zr(r.userId===n.userId);var i=Za(e.R,r);return fu(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(Ia.store),n=t.store(ma.store);return t.store(Ta.store).get(Ta.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new ii(n),s=function(t){return[0,aa(t)]}(o);r.push(e.get(s).next(function(n){return n?ka.resolve():function(n){return e.put(new Ia(0,aa(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return ka.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Ea.store,{keyPath:Ea.keyPath});var n=e.store(Ea.store),r=new au,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:aa(i)})}};return e.store(ma.store).$t({kt:!0},function(t,e){var n=new ii(t);return i(n.popLast())}).next(function(){return e.store(ya.store).$t({kt:!0},function(t,e){var n=ha(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(wa.store);return n.$t(function(t,r){var i=tu(r),o=eu(e.R,i);return n.put(o)})},t}();function qu(t){t.createObjectStore(Ia.store,{keyPath:Ia.keyPath}).createIndex(Ia.documentTargetsIndex,Ia.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(wa.store,{keyPath:wa.keyPath}).createIndex(wa.queryTargetsIndexName,wa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ta.store)}var Vu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Uu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Fr(Lr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Du(this,i),this.Le=n+"main",this.R=new Qa(u),this.Be=new xa(this.Le,11,new Mu(this.R)),this.qe=new wu(this.referenceDelegate,this.R),this.Ut=new uu,this.Ue=function(t,e){return new xu(t,e)}(this.R,this.Ut),this.Ke=new ru,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Ur("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Fr(Lr.FAILED_PRECONDITION,Vu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new Pr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(_.b)(e,void 0,void 0,function(){return Object(_.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(_.b)(e,void 0,void 0,function(){return Object(_.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(_.b)(e,void 0,void 0,function(){return Object(_.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Ku(e).put(new _a(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(La(e))return Vr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Vr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return Bu(t).get(fa.key).next(function(t){return ka.resolve(e.tn(t))})},t.prototype.en=function(t){return Ku(t).delete(this.clientId)},t.prototype.nn=function(){return Object(_.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(_.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=Ba(t,_a.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return ka.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?ka.resolve(!0):Bu(t).get(fa.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Fr(Lr.FAILED_PRECONDITION,Vu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Ku(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Vr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(_.b)(this,void 0,void 0,function(){var t=this;return Object(_.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[fa.store,_a.store],function(e){var n=new Ua(e,Pr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Ku(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return pu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Vr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Aa,function(o){return r=new Ua(o,i.Ne?i.Ne.next():Pr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw Ur("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Fr(Lr.FAILED_PRECONDITION,Na);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return Bu(t).get(fa.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Fr(Lr.FAILED_PRECONDITION,Vu)})},t.prototype.Ze=function(t){var e=new fa(this.clientId,this.allowTabSynchronization,Date.now());return Bu(t).put(fa.key,e)},t.yt=function(){return xa.yt()},t.prototype.Xe=function(t){var e=this,n=Bu(t);return n.get(fa.key).next(function(t){return e.tn(t)?(Vr("IndexedDbPersistence","Releasing primary lease."),n.delete(fa.key)):ka.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Ur("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Vr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Ur("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Ur("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Bu(t){return Ba(t,fa.store)}function Ku(t){return Ba(t,_a.store)}function Gu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var zu=function(t,e){this.progress=t,this.wn=e},Qu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return bi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):ho(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new bi(e)).next(function(t){var e=fs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=fs();return this.Ut.getCollectionParents(t,i).next(function(s){return ka.forEach(s,function(s){var a=function(t,e){return new ro(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Li.newInvalidDocument(c),r=r.insert(c,h)),Bo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){mo(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=gs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Wo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),Wu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=gs(),i=gs(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Hu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Zr.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(so(e)||ao(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(qr()<=S.a.DEBUG&&Vr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),vo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new as(bo(t));return e.forEach(function(e,r){mo(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return qr()<=S.a.DEBUG&&Vr("QueryEngine","Using full collection scan to execute query:",vo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Zr.min())},t}(),Yu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new is(Yr),this.kn=new ku(function(t){return qi(t)},Vi),this.$n=Zr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Qu(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Xu(t,e,n,r){return new Yu(t,e,n,r)}function $u(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(_.d)(this,function(s){switch(s.label){case 0:return n=Qr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Qu(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=gs(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,g=p.mutations;y<g.length;y++)s=s.add(g[y].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function Ju(t,e){var n=Qr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=ka.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);zr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function Zu(t){var e=Qr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function tc(t,e){var n=Qr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return zr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=hs();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(ec(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(Zr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return ka.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function ec(t,e,n,r,i){var o=gs();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=hs();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Zr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Vr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function nc(t,e){var n=Qr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function rc(t,e){var n=Qr(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?ka.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new za(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function ic(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(_.d)(this,function(a){switch(a.label){case 0:r=Qr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!La(s=a.sent()))throw s;return Vr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function oc(t,e,n){var r=Qr(t),i=Zr.min(),o=gs();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=Qr(t),i=r.kn.get(n);return void 0!==i?ka.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,fo(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Zr.min(),n?o:gs())}).next(function(t){return{documents:t,Bn:o}})})}function sc(t,e){var n=Qr(t),r=Qr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function ac(t){var e=Qr(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=Qr(t),i=hs(),o=Ya(n),s=Lu(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:ma.readTimeIndex,range:a},function(t,e){var n=Wa(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Xa(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function uc(t){return Object(_.b)(this,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){return[2,(e=Qr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Lu(t),n=Zr.min();return e.$t({index:ma.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Xa(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function cc(t,e,n,r){return Object(_.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(_.d)(this,function(p){switch(p.label){case 0:for(i=Qr(t),o=gs(),s=hs(),a=ps(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,rc(i,function(t){return fo(oo(ii.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return ec(t,f,s,Zr.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function hc(t,e,n){return void 0===n&&(n=gs()),Object(_.b)(this,void 0,void 0,function(){var r,i;return Object(_.d)(this,function(o){switch(o.label){case 0:return[4,rc(t,fo(nu(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Qr(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=Rs(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(ui.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(t,e)})})]}})})}var lc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return ka.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:Rs(n.createTime)}),ka.resolve()},t.prototype.getNamedQuery=function(t,e){return ka.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:nu(t.bundledQuery),readTime:Rs(t.readTime)}}(e)),ka.resolve()},t}(),fc=function(){function t(){this.Wn=new as(dc.Gn),this.zn=new as(dc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new dc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new dc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new bi(new ii([])),r=new dc(n,t),i=new dc(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new bi(new ii([])),n=new dc(e,t),r=new dc(e,t+1),i=gs();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new dc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),dc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return bi.comparator(t.key,e.key)||Yr(t.ns,e.ns)},t.Hn=function(t,e){return Yr(t.ns,e.ns)||bi.comparator(t.key,e.key)},t}(),pc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new as(dc.Gn)}return t.prototype.checkEmpty=function(t){return ka.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Ka(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new dc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return ka.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return ka.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return ka.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return ka.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return ka.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new dc(e,0),i=new dc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),ka.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new as(Yr);return e.forEach(function(t){var e=new dc(t,0),i=new dc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),ka.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;bi.isDocumentKey(i)||(i=i.child(""));var o=new dc(new bi(i),0),s=new as(Yr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),ka.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;zr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return ka.forEach(e.mutations,function(i){var o=new dc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new dc(e,0),r=this.rs.firstAfterOrEqual(n);return ka.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return ka.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),yc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new is(bi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return ka.resolve(n?n.document.clone():Li.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=hs();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Li.newInvalidDocument(t))}),ka.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=hs(),i=new bi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||mo(e,u)&&(r=r.insert(u.key,u.clone()))}return ka.resolve(r)},t.prototype.fs=function(t,e){return ka.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new gc(this)},t.prototype.getSize=function(t){return ka.resolve(this.size)},t}(),gc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(_.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),ka.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Cu),vc=function(){function t(t){this.persistence=t,this.ds=new ku(function(t){return qi(t)},Vi),this.lastRemoteSnapshotVersion=Zr.min(),this.highestTargetId=0,this.ws=0,this._s=new fc,this.targetCount=0,this.ys=bu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),ka.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return ka.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return ka.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),ka.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),ka.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new bu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,ka.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),ka.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,ka.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),ka.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return ka.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return ka.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),ka.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),ka.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),ka.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return ka.resolve(n)},t.prototype.containsKey=function(t,e){return ka.resolve(this._s.containsKey(e))},t}(),mc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Pr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new vc(this),this.Ut=new su,this.Ue=function(t,e){return new yc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new Qa(e),this.Ke=new lc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new pc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Vr("MemoryPersistence","Starting transaction:",t);var i=new bc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return ka.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),bc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(_.c)(e,t),e}(Da),wc=function(){function t(t){this.persistence=t,this.As=new fc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Gr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),ka.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),ka.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),ka.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ka.forEach(this.vs,function(r){var i=bi.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return ka.or([function(){return ka.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Ic=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Tc(t,e){return"firestore_clients_"+t+"_"+e}function Ec(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function _c(t,e){return"firestore_targets_"+t+"_"+e}Ic.UNAUTHENTICATED=new Ic(null),Ic.GOOGLE_CREDENTIALS=new Ic("google-credentials-uid"),Ic.FIRST_PARTY=new Ic("first-party-uid");var Oc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Fr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Ur("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Sc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Fr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Ur("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Ac=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ms(),s=0;i&&s<r.activeTargetIds.length;++s)i=mi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Ur("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Nc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Ur("SharedClientState","Failed to parse online state: "+e),null)},t}(),Dc=function(){function t(){this.activeTargetIds=ms()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),jc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new is(Yr),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Tc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Dc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(_.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(_.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Tc(this.persistenceKey,r)))&&(o=Ac.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.Fs(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(_c(this.persistenceKey,t));if(n){var r=Sc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(_c(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Vr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Vr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Vr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Vr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Ur("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(_.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(_.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Pr.o;if(null!=t)try{var n=JSON.parse(t);zr("number"==typeof n),e=n}catch(t){Ur("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Pr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Oc(this.currentUser,t,e,n),i=Ec(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Ec(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=_c(this.persistenceKey,t),i=new Sc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Ac.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Oc.Vs(new Ic(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Sc.Vs(r,e)},t.prototype.js=function(t){return Nc.Vs(t)},t.prototype.ii=function(t){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Vr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ms();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),kc=function(){function t(){this.li=new Dc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Dc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Cc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),xc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Vr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Vr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Rc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Pc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Lc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(_.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new Rr;s.listenOnce(jr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Dr.NO_ERROR:var e=s.getResponseJson();Vr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Dr.TIMEOUT:Vr("Connection",'RPC "'+t+'" timed out'),o(new Fr(Lr.DEADLINE_EXCEEDED,"Request time out"));break;case Dr.HTTP_ERROR:var n=s.getStatus();if(Vr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Lr).indexOf(e)>=0?e:Lr.UNKNOWN}(r.status);o(new Fr(a,r.message))}else o(new Fr(Lr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Fr(Lr.UNAVAILABLE,"Connection failed."));break;default:Gr()}}finally{Vr("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new _r,i=ve(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Cr({})),this.Fi(o.initMessageHeaders,e),Object(O.o)()||Object(O.q)()||Object(O.m)()||Object(O.n)()||Object(O.r)()||Object(O.l)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Vr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Pc({Ei:function(t){c?Vr("Connection","Not sending because WebChannel is closed:",t):(u||(Vr("Connection","Opening WebChannel transport."),a.open(),u=!0),Vr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,xr.EventType.OPEN,function(){c||Vr("Connection","WebChannel transport opened.")}),l(a,xr.EventType.CLOSE,function(){c||(c=!0,Vr("Connection","WebChannel transport closed"),h.Vi())}),l(a,xr.EventType.ERROR,function(t){c||(c=!0,Br("Connection","WebChannel transport errored:",t),h.Vi(new Fr(Lr.UNAVAILABLE,"The operation could not be completed")))}),l(a,xr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];zr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Vr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=$o[t];if(void 0!==e)return rs(e)}(i),s=r.message;void 0===o&&(o=Lr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Fr(o,s)),a.close()}else Vr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,kr.STAT_EVENT,function(t){10===t.stat?Vr("Connection","Detected buffering proxy"):11===t.stat&&Vr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Vr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Vr("RestConnection","Received: ",t),t},function(e){throw Br("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.7.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Rc[t]},t}());function Fc(){return"undefined"!=typeof window?window:null}function Mc(){return"undefined"!=typeof document?document:null}function qc(t){return new js(t,!0)}var Vc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&Vr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Uc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Vc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Lr.RESOURCE_EXHAUSTED?(Ur(e.toString()),Ur("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===Lr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new Fr(Lr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(_.b)(t,void 0,void 0,function(){return Object(_.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Vr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Vr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Bc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(_.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Gr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(zr(void 0===e||"string"==typeof e),ui.fromBase64String(e||"")):(zr(void 0===e||e instanceof Uint8Array),ui.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Lr.UNKNOWN:rs(t.code);return new Fr(e,t.message||"")}(a);n=new Es(r,i,o,s||null)}else if("documentChange"in e){i=Ms(t,(r=e.documentChange).document.name),o=Rs(r.document.updateTime);var a=new Ri({mapValue:{fields:r.document.fields}}),u=(s=Li.newFoundDocument(i,o,a),r.targetIds||[]);n=new Is(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Ms(t,(r=e.documentDelete).document),o=r.readTime?Rs(r.readTime):Zr.min(),a=Li.newNoDocument(i,o),n=new Is([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Ms(t,(r=e.documentRemove).document),n=new Is([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Gr();var c=e.filter;i=new es(r=c.count||0),n=new Ts(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Zr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Zr.min():e.readTime?Rs(e.readTime):Zr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Us(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Ui(r)?{documents:Ws(t,r)}:{query:Hs(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Cs(t,e.resumeToken):e.snapshotVersion.compareTo(Zr.min())>0&&(n.readTime=ks(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Gr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Us(this.R),e.removeTarget=t,this.cr(e)},e}(Uc),Kc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(_.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(zr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(zr(void 0!==e),t.map(function(t){return function(t,e){var n=Rs(t.updateTime?t.updateTime:e);return n.isEqual(Zr.min())&&(n=Rs(e)),new Fo(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Rs(t.commitTime);return this.listener.Tr(n,e)}return zr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Us(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return zs(e.R,t)})};this.cr(n)},e}(Uc),Gc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(_.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new Fr(Lr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Lr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Fr(Lr.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Lr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Fr(Lr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),zc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Ur(e),this.Vr=!1):Vr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Qc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(_.b)(o,void 0,void 0,function(){return Object(_.d)(this,function(t){switch(t.label){case 0:return eh(this)?(Vr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(_.b)(this,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){switch(n.label){case 0:return(e=Qr(t)).Or.add(4),[4,Hc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Wc(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new zc(n,r)};function Wc(t){return Object(_.b)(this,void 0,void 0,function(){var e,n;return Object(_.d)(this,function(r){switch(r.label){case 0:if(!eh(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Hc(t){return Object(_.b)(this,void 0,void 0,function(){var e,n;return Object(_.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Yc(t,e){var n=Qr(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),th(n)?Zc(n):gh(n).er()&&$c(n,e))}function Xc(t,e){var n=Qr(t),r=gh(n);n.$r.delete(e),r.er()&&Jc(n,e),0===n.$r.size&&(r.er()?r.ir():eh(n)&&n.Br.set("Unknown"))}function $c(t,e){t.qr.U(e.targetId),gh(t).mr(e)}function Jc(t,e){t.qr.U(e),gh(t).yr(e)}function Zc(t){t.qr=new Os({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),gh(t).start(),t.Br.Sr()}function th(t){return eh(t)&&!gh(t).tr()&&t.$r.size>0}function eh(t){return 0===Qr(t).Or.size}function nh(t){t.qr=void 0}function rh(t){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(e){return t.$r.forEach(function(e,n){$c(t,e)}),[2]})})}function ih(t,e){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(n){return nh(t),th(t)?(t.Br.Nr(e),Zc(t)):t.Br.set("Unknown"),[2]})})}function oh(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r,i,o;return Object(_.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof Es&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(_.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Vr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,sh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Is?t.qr.X(e):e instanceof Ts?t.qr.rt(e):t.qr.et(e),n.isEqual(Zr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Zu(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(ui.EMPTY_BYTE_STRING,n.snapshotVersion)),Jc(t,e);var r=new za(n.target,e,1,n.sequenceNumber);$c(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Vr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,sh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function sh(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r=this;return Object(_.d)(this,function(i){switch(i.label){case 0:if(!La(e))throw e;return t.Or.add(1),[4,Hc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Zu(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(_.b)(r,void 0,void 0,function(){return Object(_.d)(this,function(e){switch(e.label){case 0:return Vr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Wc(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function ah(t,e){return e().catch(function(n){return sh(t,n,e)})}function uh(t){return Object(_.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(_.d)(this,function(s){switch(s.label){case 0:e=Qr(t),n=vh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return eh(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,nc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=vh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,sh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return ch(e)&&hh(e),[2]}})})}function ch(t){return eh(t)&&!vh(t).tr()&&t.kr.length>0}function hh(t){vh(t).start()}function lh(t){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(e){return vh(t).Ar(),[2]})})}function fh(t){return Object(_.b)(this,void 0,void 0,function(){var e,n,r;return Object(_.d)(this,function(i){for(e=vh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function dh(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r,i;return Object(_.d)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Ga.from(r,e,n),[4,ah(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,uh(t)];case 2:return o.sent(),[2]}})})}function ph(t,e){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(n){switch(n.label){case 0:return e&&vh(t).pr?[4,function(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r;return Object(_.d)(this,function(i){switch(i.label){case 0:return ns(r=e.code)&&r!==Lr.ABORTED?(n=t.kr.shift(),vh(t).sr(),[4,ah(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,uh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return ch(t)&&hh(t),[2]}})})}function yh(t,e){return Object(_.b)(this,void 0,void 0,function(){var n;return Object(_.d)(this,function(r){switch(r.label){case 0:return n=Qr(t),e?(n.Or.delete(2),[4,Wc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Hc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function gh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Qr(t);return r.br(),new Bc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:rh.bind(null,t),Ri:ih.bind(null,t),_r:oh.bind(null,t)}),t.Mr.push(function(n){return Object(_.b)(e,void 0,void 0,function(){return Object(_.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),th(t)?Zc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),nh(t),e.label=3;case 3:return[2]}})})})),t.Ur}function vh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=Qr(t);return r.br(),new Kc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:lh.bind(null,t),Ri:ph.bind(null,t),Ir:fh.bind(null,t),Tr:dh.bind(null,t)}),t.Mr.push(function(n){return Object(_.b)(e,void 0,void 0,function(){return Object(_.d)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,uh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&(Vr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var mh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ja,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Fr(Lr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function bh(t,e){if(Ur("AsyncQueue",e+": "+t),La(t))return new Fr(Lr.UNAVAILABLE,e+": "+t);throw t}var wh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||bi.comparator(e.key,n.key)}:function(t,e){return bi.comparator(t.key,e.key)},this.keyedMap=fs(),this.sortedSet=new is(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Ih=function(){function t(){this.Qr=new is(bi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Gr():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Th=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,wh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&yo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Eh=function(){this.Wr=void 0,this.listeners=[]},_h=function(){this.queries=new ku(function(t){return go(t)},yo),this.onlineState="Unknown",this.Gr=new Set};function Oh(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(_.d)(this,function(c){switch(c.label){case 0:if(n=Qr(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Eh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=bh(a,"Initialization of query '"+vo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Dh(n),[2]}})})}function Sh(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(_.d)(this,function(a){return n=Qr(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Ah(t,e){for(var n=Qr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Dh(n)}function Nh(t,e,n){var r=Qr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Dh(t){t.Gr.forEach(function(t){t.next()})}var jh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Th(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Th.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),kh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Ch=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Ms(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Gs(this.R,t.document,!1):Li.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return Rs(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Ch(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||gs()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(_.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(_.d)(this,function(o){switch(o.label){case 0:return[4,cc(this.localStore,new Ch(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,hc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new zu(Object.assign({},this.progress),t))]}})})}}();var xh=function(t){this.key=t},Rh=function(t){this.key=t},Ph=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=gs(),this.mutatedKeys=gs(),this.lo=bo(t),this.fo=new wh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Ih,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=so(this.query)&&i.size===this.query.limit?i.last():null,c=ao(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=mo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),so(this.query)||ao(this.query))for(;s.size>this.query.limit;){var h=so(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Gr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Th(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Ih,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=gs(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Rh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new xh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=gs();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Th.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Lh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Fh=function(t){this.key=t,this.bo=!1},Mh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new ku(function(t){return go(t)},yo),this.Vo=new Map,this.So=new Set,this.Do=new is(bi.comparator),this.Co=new Map,this.No=new fc,this.xo={},this.Fo=new Map,this.ko=bu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function qh(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(_.d)(this,function(a){switch(a.label){case 0:return n=pl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,rc(n.localStore,fo(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Vh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&Yc(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Vh(t,e,n,r){return Object(_.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(_.d)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(_.b)(this,void 0,void 0,function(){var i,o,s;return Object(_.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,oc(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Zh(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,oc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Ph(e,i.Bn),s=o._o(i.documents),a=ws.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Zh(t,n,u.To),c=new Lh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Uh(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i;return Object(_.d)(this,function(o){switch(o.label){case 0:return n=Qr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!yo(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,ic(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Xc(n.remoteStore,r.targetId),$h(n,r.targetId)}).catch(_u)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return $h(n,r.targetId),[4,ic(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function Bh(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(_.d)(this,function(a){switch(a.label){case 0:r=yl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Qr(t),i=Jr.now(),o=e.reduce(function(t,e){return t.add(e.key)},gs());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Ko(c,n.get(c.key));null!=h&&s.push(new Wo(c.key,h,Pi(h.value.mapValue),Mo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new is(Yr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,nl(r,i.changes)];case 3:return a.sent(),[4,uh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=bh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Kh(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r;return Object(_.d)(this,function(i){switch(i.label){case 0:n=Qr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,tc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(zr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?zr(r.bo):t.removedDocuments.size>0&&(zr(r.bo),r.bo=!1))}),[4,nl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,_u(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Gh(t,e,n){var r=Qr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=Qr(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Dh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function zh(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(_.d)(this,function(c){switch(c.label){case 0:return(r=Qr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new is(bi.comparator)).insert(o,Li.newNoDocument(o,Zr.min())),a=gs().add(o),u=new bs(Zr.min(),new Map,new as(Yr),s,a),[4,Kh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),el(r),[3,4];case 2:return[4,ic(r.localStore,e,!1).then(function(){return $h(r,e,n)}).catch(_u)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function Qh(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i;return Object(_.d)(this,function(o){switch(o.label){case 0:n=Qr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Ju(n.localStore,e)];case 2:return i=o.sent(),Xh(n,r,null),Yh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,nl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,_u(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Wh(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r,i;return Object(_.d)(this,function(o){switch(o.label){case 0:r=Qr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Qr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return zr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Xh(r,e,n),Yh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,nl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,_u(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Hh(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(_.d)(this,function(a){switch(a.label){case 0:eh((n=Qr(t)).remoteStore)||Vr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Qr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=bh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function Yh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Xh(t,e,n){var r=Qr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function $h(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||Jh(t,e)})}function Jh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Xc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),el(t))}function Zh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof xh?(t.No.addReference(o.key,e),tl(t,o)):o instanceof Rh?(Vr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Jh(t,o.key)):Gr()}}function tl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Vr("SyncEngine","New document in limbo: "+n),t.So.add(r),el(t))}function el(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new bi(ii.fromString(e)),r=t.ko.next();t.Co.set(r,new Fh(n)),t.Do=t.Do.insert(n,r),Yc(t.remoteStore,new za(fo(oo(n.path)),r,2,Pr.o))}}function nl(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(_.d)(this,function(a){switch(a.label){case 0:return r=Qr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Wu.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(_.d)(this,function(h){switch(h.label){case 0:n=Qr(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return ka.forEach(e,function(e){return ka.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return ka.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!La(r=h.sent()))throw r;return Vr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function rl(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r;return Object(_.d)(this,function(i){switch(i.label){case 0:return(n=Qr(t)).currentUser.isEqual(e)?[3,3]:(Vr("SyncEngine","User change. New user:",e.toKey()),[4,$u(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new Fr(Lr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,nl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function il(t,e){var n=Qr(t),r=n.Co.get(e);if(r&&r.bo)return gs().add(r.key);var i=gs(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function ol(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i;return Object(_.d)(this,function(o){switch(o.label){case 0:return[4,oc((n=Qr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Zh(n,e.targetId,i.To),i)]}})})}function sl(t){return Object(_.b)(this,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){return[2,ac((e=Qr(t)).localStore).then(function(t){return nl(e,t)})]})})}function al(t,e,n,r){return Object(_.b)(this,void 0,void 0,function(){var i,o;return Object(_.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=Qr(t),r=Qr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):ka.resolve(null)})})}((i=Qr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,uh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Xh(i,e,r||null),Yh(i,e),function(t,e){Qr(Qr(t)._n).Gt(e)}(i.localStore,e)):Gr(),s.label=4;case 4:return[4,nl(i,o)];case 5:return s.sent(),[3,7];case 6:Vr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function ul(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(_.d)(this,function(c){switch(c.label){case 0:return pl(n=Qr(t)),yl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,cl(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,yh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)Yc(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return $h(n,e),ic(n.localStore,e,!0)}),Xc(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,cl(n,a)];case 5:return c.sent(),function(t){var e=Qr(t);e.Co.forEach(function(t,n){Xc(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new is(bi.comparator)}(n),n.$o=!1,[4,yh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function cl(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(_.d)(this,function(y){switch(y.label){case 0:n=Qr(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,rc(n.localStore,fo(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,ol(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,sc(n.localStore,a)];case 8:return p=y.sent(),[4,rc(n.localStore,p)];case 9:return u=y.sent(),[4,Vh(n,hl(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function hl(t){return io(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function ll(t){var e=Qr(t);return Qr(Qr(e.localStore).persistence).fn()}function fl(t,e,n,r){return Object(_.b)(this,void 0,void 0,function(){var i,o,s;return Object(_.d)(this,function(a){switch(a.label){case 0:return(i=Qr(t)).$o?(Vr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,ac(i.localStore)];case 3:return o=a.sent(),s=bs.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,nl(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,ic(i.localStore,e,!0)];case 6:return a.sent(),$h(i,e,r),[3,8];case 7:Gr(),a.label=8;case 8:return[2]}})})}function dl(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(_.d)(this,function(f){switch(f.label){case 0:if(!(r=pl(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Vr("SyncEngine","Adding an already active target "+s),[3,5]):[4,sc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,rc(r.localStore,a)];case 3:return u=f.sent(),[4,Vh(r,hl(a),u.targetId,!1)];case 4:f.sent(),Yc(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(_.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,ic(r.localStore,t,!1).then(function(){Xc(r.remoteStore,t),$h(r,t)}).catch(_u)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function pl(t){var e=Qr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Kh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=il.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=zh.bind(null,e),e.vo._r=Ah.bind(null,e.eventManager),e.vo.Mo=Nh.bind(null,e.eventManager),e}function yl(t){var e=Qr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Qh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Wh.bind(null,e),e}var gl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(e){switch(e.label){case 0:return this.R=qc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return Xu(this.persistence,new Hu,t.initialUser,this.R)},t.prototype.qo=function(t){return new mc(wc.bs,this.R)},t.prototype.Bo=function(t){return new kc},t.prototype.terminate=function(){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),vl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(_.c)(e,t),e.prototype.initialize=function(e){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,uc(this.localStore)];case 2:return n.sent(),[4,this.Qo.initialize(this,e)];case 3:return n.sent(),[4,yl(this.Qo.syncEngine)];case 4:return n.sent(),[4,uh(this.Qo.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Ko=function(t){return Xu(this.persistence,new Hu,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Au(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Gu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?lu.withCacheSize(this.cacheSizeBytes):lu.DEFAULT;return new Uu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Fc(),Mc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new kc},e}(gl),ml=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(_.c)(e,t),e.prototype.initialize=function(e){return Object(_.b)(this,void 0,void 0,function(){var n,r=this;return Object(_.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof jc?(this.sharedClientState.syncEngine={ui:al.bind(null,n),ai:fl.bind(null,n),hi:dl.bind(null,n),fn:ll.bind(null,n),ci:sl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(_.b)(r,void 0,void 0,function(){return Object(_.d)(this,function(e){switch(e.label){case 0:return[4,ul(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Fc();if(!jc.yt(e))throw new Fr(Lr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Gu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new jc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(vl),bl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(_.b)(this,void 0,void 0,function(){var n=this;return Object(_.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Gh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=rl.bind(null,this.syncEngine),[4,yh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new _h},t.prototype.createDatastore=function(t){var e=qc(t.databaseInfo.databaseId),n=new Lc(t.databaseInfo);return function(t,e,n){return new Gc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Gh(s.syncEngine,t,0)},o=xc.yt()?new xc:new Cc,new Qc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Mh(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(_.b)(this,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){switch(n.label){case 0:return e=Qr(t),Vr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Hc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),wl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Il=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new ja,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(_.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(_.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new kh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(_.b)(this,void 0,void 0,function(){var t,e;return Object(_.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(_.b)(this,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(_.b)(this,void 0,void 0,function(){var t,e;return Object(_.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(_.b)(this,void 0,void 0,function(){var e,n=this;return Object(_.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Fr(Lr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(_.d)(this,function(u){switch(u.label){case 0:return n=Qr(t),r=Us(n.R)+"/documents",i={documents:e.map(function(t){return Fs(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){zr(!!e.found);var n=Ms(t,e.found.name),r=Rs(e.found.updateTime),i=new Ri({mapValue:{fields:e.found.fields}});return Li.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){zr(!!e.missing),zr(!!e.readTime);var n=Ms(t,e.missing),r=Rs(e.readTime);return Li.newNoDocument(n,r)}(t,e):Gr()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());zr(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Zo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(_.b)(this,void 0,void 0,function(){var t,e=this;return Object(_.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=bi.fromPath(n);e.mutations.push(new ts(r,e.precondition(r)))}),[4,function(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i;return Object(_.d)(this,function(o){switch(o.label){case 0:return n=Qr(t),r=Us(n.R)+"/documents",i={writes:e.map(function(t){return zs(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Gr();e=Zr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Fr(Lr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Mo.updateTime(e):Mo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Zr.min()))throw new Fr(Lr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Mo.updateTime(e)}return Mo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),Tl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Vc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(_.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(_.d)(this,function(r){return t=new Il(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!gi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!ns(e)}return!1},t}(),El=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Ic.UNAUTHENTICATED,this.clientId=Hr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(_.b)(r,void 0,void 0,function(){return Object(_.d)(this,function(e){switch(e.label){case 0:return Vr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Fr(Lr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new ja;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(_.b)(t,void 0,void 0,function(){var t,n;return Object(_.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=bh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function _l(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(_.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Vr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(_.b)(i,void 0,void 0,function(){return Object(_.d)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,$u(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function Ol(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r;return Object(_.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Sl(t)];case 1:return n=i.sent(),Vr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(_.b)(this,void 0,void 0,function(){var n,r;return Object(_.d)(this,function(i){switch(i.label){case 0:return(n=Qr(t)).asyncQueue.verifyOperationInProgress(),Vr("RemoteStore","RemoteStore received new credentials"),r=eh(n),n.Or.add(3),[4,Hc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Wc(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function Sl(t){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Vr("FirestoreClient","Using default OfflineComponentProvider"),[4,_l(t,new gl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Al(t){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Vr("FirestoreClient","Using default OnlineComponentProvider"),[4,Ol(t,new bl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Nl(t){return Sl(t).then(function(t){return t.persistence})}function Dl(t){return Sl(t).then(function(t){return t.localStore})}function jl(t){return Al(t).then(function(t){return t.remoteStore})}function kl(t){return Al(t).then(function(t){return t.syncEngine})}function Cl(t){return Object(_.b)(this,void 0,void 0,function(){var e,n;return Object(_.d)(this,function(r){switch(r.label){case 0:return[4,Al(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=qh.bind(null,e.syncEngine),n.onUnlisten=Uh.bind(null,e.syncEngine),n)]}})})}function xl(t,e,n){var r=this;void 0===n&&(n={});var i=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(r,void 0,void 0,function(){var r;return Object(_.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new wl({next:function(o){e.enqueueAndForget(function(){return Sh(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Fr(Lr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Fr(Lr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new jh(oo(n.path),o,{includeMetadataChanges:!0,so:!0});return Oh(t,s)},[4,Cl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Rl(t,e,n){var r=this;void 0===n&&(n={});var i=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(r,void 0,void 0,function(){var r;return Object(_.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new wl({next:function(n){e.enqueueAndForget(function(){return Sh(t,s)}),n.fromCache&&"server"===r.source?i.reject(new Fr(Lr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new jh(n,o,{includeMetadataChanges:!0,so:!0});return Oh(t,s)},[4,Cl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Pl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Ll=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Fl=new Map,Ml=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},ql=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(Ic.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Vl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Ul=function(){function t(t){var e=this;this.currentUser=Ic.UNAUTHENTICATED,this.oc=new ja,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){Vr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Vr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Vr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(zr("string"==typeof n.accessToken),new Ml(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return Object(_.b)(n,void 0,void 0,function(){return Object(_.d)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return zr(null===t||"string"==typeof t),new Ic(t)},t}(),Bl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Ic.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Kl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Bl(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(Ic.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Gl(t,e,n){if(!n)throw new Fr(Lr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function zl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Ql(t,e,n,r){if(!0===e&&!0===r)throw new Fr(Lr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Wl(t){if(!bi.isDocumentKey(t))throw new Fr(Lr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Hl(t){if(bi.isDocumentKey(t))throw new Fr(Lr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Yl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Gr()}function Xl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Fr(Lr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Yl(t);throw new Fr(Lr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function $l(t,e){if(e<=0)throw new Fr(Lr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Jl=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Fr(Lr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Fr(Lr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Ql("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Zl=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jl({}),this._settingsFrozen=!1,t instanceof Ll?(this._databaseId=t,this._credentials=new ql):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Fr(Lr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ll(t.options.projectId)}(t),this._credentials=new Ul(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Fr(Lr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Fr(Lr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new ql;switch(t.type){case"gapi":var e=t.client;return zr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Kl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Fr(Lr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Fl.get(this))&&(Vr("ComponentProvider","Removing Datastore"),Fl.delete(this),t.terminate()),Promise.resolve();var t},t}(),tf=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new nf(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),ef=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),nf=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,oo(r))||this)._path=r,i.type="collection",i}return Object(_.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new tf(this.firestore,null,new bi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(ef);function rf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(O.i)(t),Gl("collection","path",e),t instanceof Zl)return Hl(n=ii.fromString.apply(ii,Object(_.f)([e],r))),new nf(t,null,n);if(!(t instanceof tf||t instanceof nf))throw new Fr(Lr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Hl(n=ii.fromString.apply(ii,Object(_.f)([t.path],r)).child(ii.fromString(e))),new nf(t.firestore,null,n)}function of(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(O.i)(t),1===arguments.length&&(e=Hr.u()),Gl("doc","path",e),t instanceof Zl)return Wl(n=ii.fromString.apply(ii,Object(_.f)([e],r))),new tf(t,null,new bi(n));if(!(t instanceof tf||t instanceof nf))throw new Fr(Lr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Wl(n=t._path.child(ii.fromString.apply(ii,Object(_.f)([e],r)))),new tf(t.firestore,t instanceof nf?t.converter:null,new bi(n))}function sf(t,e){return t=Object(O.i)(t),e=Object(O.i)(e),(t instanceof tf||t instanceof nf)&&(e instanceof tf||e instanceof nf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function af(t,e){return t=Object(O.i)(t),e=Object(O.i)(e),t instanceof ef&&e instanceof ef&&t.firestore===e.firestore&&yo(t._query,e._query)&&t.converter===e.converter}var uf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new Vc(this,"async_queue_retry"),this.Tc=function(){var e=Mc();e&&Vr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Mc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Tc)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ic(),this.Ac(t)},t.prototype.enterRestrictedMode=function(){if(!this._c){this._c=!0;var t=Mc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tc)}},t.prototype.enqueue=function(t){return this.Ic(),this._c?new Promise(function(t){}):this.Ac(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.Rc()})},t.prototype.Rc=function(){return Object(_.b)(this,void 0,void 0,function(){var t,e=this;return Object(_.d)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!La(t=n.sent()))throw t;return Vr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.Rc()}),n.label=5;case 5:return[2]}})})},t.prototype.Ac=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,Ur("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ic(),this.Ec.indexOf(t)>-1&&(e=0);var i=mh.createAndSchedule(this,t,e,n,function(t){return r.bc(t)});return this.mc.push(i),i},t.prototype.Ic=function(){this.yc&&Gr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.vc=function(){return Object(_.b)(this,void 0,void 0,function(){var t;return Object(_.d)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Pc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Vc=function(t){var e=this;return this.vc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.vc()})},t.prototype.Sc=function(t){this.Ec.push(t)},t.prototype.bc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function cf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new ja,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var hf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new uf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(_.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||ff(this),this._firestoreClient.terminate()},e}(Zl);function lf(t){return t._firestoreClient||ff(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function ff(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Pl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new El(t._credentials,t._queue,r)}function df(t,e,n){var r=this,i=new ja;return t.asyncQueue.enqueue(function(){return Object(_.b)(r,void 0,void 0,function(){var r;return Object(_.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,_l(t,n)];case 1:return o.sent(),[4,Ol(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Lr.FAILED_PRECONDITION||t.code===Lr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function pf(t){if(t._initialized||t._terminated)throw new Fr(Lr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var yf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new si(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),gf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(ui.fromBase64String(e))}catch(e){throw new Fr(Lr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(ui.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),vf=function(t){this._methodName=t},mf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Fr(Lr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Fr(Lr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Yr(this._lat,t._lat)||Yr(this._long,t._long)},t}(),bf=/^__.*__$/,wf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Wo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Qo(t,this.data,e,this.fieldTransforms)},t}(),If=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Wo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function Tf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Gr()}}var Ef=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Cc",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),t.prototype.Nc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.xc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.kc(t),r},t.prototype.$c=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.Dc(),r},t.prototype.Oc=function(t){return this.Nc({path:void 0,Fc:!0})},t.prototype.Mc=function(t){return Kf(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Dc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.kc(this.path.get(t))},t.prototype.kc=function(t){if(0===t.length)throw this.Mc("Document fields must not be empty");if(Tf(this.Cc)&&bf.test(t))throw this.Mc('Document fields cannot begin and end with "__"')},t}(),_f=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||qc(t)}return t.prototype.qc=function(t,e,n,r){return void 0===r&&(r=!1),new Ef({Cc:t,methodName:e,Bc:n,path:si.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Of(t){var e=t._freezeSettings(),n=qc(t._databaseId);return new _f(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Sf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.qc(o.merge||o.mergeFields?2:0,e,n,i);qf("Data must be an object, but it was:",s,r);var a,u,c=Ff(r,s);if(o.merge)a=new ai(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Vf(e,f[l],n);if(!s.contains(d))throw new Fr(Lr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Gf(h,d)||h.push(d)}a=new ai(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new wf(new Ri(c),a,u)}var Af=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Cc)throw t.Mc(1===t.Cc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(vf);function Nf(t,e,n){return new Ef({Cc:3,Bc:e.settings.Bc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Df=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.c)(e,t),e.prototype._toFieldTransform=function(t){return new Lo(t.path,new No)},e.prototype.isEqual=function(t){return t instanceof e},e}(vf),jf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(_.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Nf(this,t,!0),n=this.Uc.map(function(t){return Lf(t,e)}),r=new Do(n);return new Lo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(vf),kf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(_.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Nf(this,t,!0),n=this.Uc.map(function(t){return Lf(t,e)}),r=new ko(n);return new Lo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(vf),Cf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(_.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new xo(t.R,Eo(t.R,this.Kc));return new Lo(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(vf);function xf(t,e,n,r){var i=t.qc(1,e,n);qf("Data must be an object, but it was:",i,r);var o=[],s=Ri.empty();ei(r,function(t,r){var a=Bf(e,t,n);r=Object(O.i)(r);var u=i.$c(a);if(r instanceof Af)o.push(a);else{var c=Lf(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new ai(o);return new If(s,a,i.fieldTransforms)}function Rf(t,e,n,r,i,o){var s=t.qc(1,e,n),a=[Vf(e,r,n)],u=[i];if(o.length%2!=0)throw new Fr(Lr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Vf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Ri.empty(),f=a.length-1;f>=0;--f)if(!Gf(h,a[f])){var d=a[f],p=u[f];p=Object(O.i)(p);var y=s.$c(d);if(p instanceof Af)h.push(d);else{var g=Lf(p,y);null!=g&&(h.push(d),l.set(d,g))}}var v=new ai(h);return new If(l,v,s.fieldTransforms)}function Pf(t,e,n,r){return void 0===r&&(r=!1),Lf(n,t.qc(r?4:3,e))}function Lf(t,e){if(Mf(t=Object(O.i)(t)))return qf("Unsupported field value:",e,t),Ff(t,e);if(t instanceof vf)return function(t,e){if(!Tf(e.Cc))throw e.Mc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Mc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Cc)throw e.Mc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Lf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(O.i)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Eo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Jr.fromDate(t);return{timestampValue:ks(e.R,n)}}if(t instanceof Jr)return n=new Jr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ks(e.R,n)};if(t instanceof mf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof gf)return{bytesValue:Cs(e.R,t._byteString)};if(t instanceof tf){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Mc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ps(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Mc("Unsupported field value: "+Yl(t))}(t,e)}function Ff(t,e){var n={};return ni(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ei(t,function(t,r){var i=Lf(r,e.xc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Mf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Jr||t instanceof mf||t instanceof gf||t instanceof tf||t instanceof vf)}function qf(t,e,n){if(!Mf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Yl(n);throw e.Mc("an object"===r?t+" a custom object":t+" "+r)}}function Vf(t,e,n){if((e=Object(O.i)(e))instanceof yf)return e._internalPath;if("string"==typeof e)return Bf(t,e);throw Kf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Uf=new RegExp("[~\\*/\\[\\]]");function Bf(t,e,n){if(e.search(Uf)>=0)throw Kf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(yf.bind.apply(yf,Object(_.f)([void 0],e.split(".")))))._internalPath}catch(Kd){throw Kf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Kf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Fr(Lr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Gf(t,e){return t.some(function(t){return t.isEqual(e)})}var zf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new tf(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Qf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Wf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Qf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(zf);function Wf(t,e){return"string"==typeof e?Bf(t,e):e instanceof yf?e._internalPath:e._delegate._internalPath}var Hf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Yf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(_.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Xf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Wf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(zf),Xf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Yf),$f=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Hf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Xf(n._firestore,n._userDataWriter,r.key,r,new Hf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Fr(Lr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Xf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Hf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Xf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Hf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Jf(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Jf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Gr()}}function Zf(t,e){return t instanceof Yf&&e instanceof Yf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof $f&&e instanceof $f&&t._firestore===e._firestore&&af(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function td(t){if(ao(t)&&0===t.explicitOrderBy.length)throw new Fr(Lr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ed=function(){};function nd(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var rd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.jc=n,i.Wc=r,i.type="where",i}return Object(_.c)(e,t),e.prototype._apply=function(t){var e=Of(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){hd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(cd(r,t,h[c]));a={arrayValue:{values:u}}}else a=cd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||hd(s,o),a=Pf(n,"where",s,"in"===o||"not-in"===o);var l=Bi.create(i,o,a);return function(t,e){if(e.g()){var n=co(t);if(null!==n&&!n.isEqual(e.field))throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=uo(t);null!==r&&ld(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Fr(Lr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Qc,this.jc,this.Wc);return new ef(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(ed),id=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Gc=n,r.type="orderBy",r}return Object(_.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Zi(e,n);return function(t,e){if(null===uo(t)){var n=co(t);null!==n&&ld(0,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Gc);return new ef(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new ro(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(ed),od=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.zc=n,i.Hc=r,i}return Object(_.c)(e,t),e.prototype._apply=function(t){return new ef(t.firestore,t.converter,po(t._query,this.zc,this.Hc))},e}(ed),sd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(_.c)(e,t),e.prototype._apply=function(t){var e=ud(t,this.type,this.Jc,this.Yc);return new ef(t.firestore,t.converter,function(t,e){return new ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(ed),ad=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(_.c)(e,t),e.prototype._apply=function(t){var e=ud(t,this.type,this.Jc,this.Yc);return new ef(t.firestore,t.converter,function(t,e){return new ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(ed);function ud(t,e,n,r){if(n[0]=Object(O.i)(n[0]),n[0]instanceof zf)return function(t,e,n,r,i){if(!r)throw new Fr(Lr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=lo(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Ai(e,r.key));else{var c=r.data.field(u.field);if(di(c))throw new Fr(Lr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new $i(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Of(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Fr(Lr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!ho(t)&&-1!==c.indexOf("/"))throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(ii.fromString(c));if(!bi.isDocumentKey(h))throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new bi(h);a.push(Ai(e,l))}else{var f=Pf(n,r,c);a.push(f)}}return new $i(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function cd(t,e,n){if("string"==typeof(n=Object(O.i)(n))){if(""===n)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ho(e)&&-1!==n.indexOf("/"))throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(ii.fromString(n));if(!bi.isDocumentKey(r))throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ai(t,new bi(r))}if(n instanceof tf)return Ai(t,n._key);throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Yl(n)+".")}function hd(t,e){if(!Array.isArray(t)||0===t.length)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function ld(t,e,n){if(!n.isEqual(e))throw new Fr(Lr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var fd=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),wi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return li(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(fi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Gr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return ei(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new mf(li(t.latitude),li(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=pi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(yi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=hi(t);return new Jr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=ii.fromString(t);zr(sa(n));var r=new Ll(n.get(1),n.get(3)),i=new bi(n.popFirst(5));return r.isEqual(e)||Ur("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function dd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var pd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(_.c)(e,t),e.prototype.convertBytes=function(t){return new gf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new tf(this.firestore,null,e)},e}(fd),yd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Of(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=gd(t,this._firestore),i=dd(r.converter,e,n),o=Sf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Mo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=gd(t,this._firestore);return o="string"==typeof(e=Object(O.i)(e))||e instanceof yf?Rf(this._dataReader,"WriteBatch.update",s._key,e,n,r):xf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Mo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=gd(t,this._firestore);return this._mutations=this._mutations.concat(new Zo(e._key,Mo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Fr(Lr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function gd(t,e){if((t=Object(O.i)(t)).firestore!==e)throw new Fr(Lr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var vd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(_.c)(e,t),e.prototype.convertBytes=function(t){return new gf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new tf(this.firestore,null,e)},e}(fd);function md(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Xl(t,tf);var o=Xl(t.firestore,hf),s=Of(o);return wd(o,[("string"==typeof(e=Object(O.i)(e))||e instanceof yf?Rf(s,"updateDoc",t._key,e,n,r):xf(s,"updateDoc",t._key,e)).toMutation(t._key,Mo.exists(!0))])}function bd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(O.i)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||cf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(cf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof tf)c=Xl(t.firestore,hf),h=oo(t._key.path),u={next:function(e){i[a]&&i[a](Id(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Xl(t,ef);c=Xl(d.firestore,hf),h=d._query;var p=new vd(c);u={next:function(t){i[a]&&i[a](new $f(c,p,d,t))},error:i[a+1],complete:i[a+2]},td(t._query)}return function(t,e,n,r){var i=this,o=new wl(r),s=new jh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(i,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){switch(n.label){case 0:return e=Oh,[4,Cl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(i,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){switch(n.label){case 0:return e=Sh,[4,Cl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(lf(c),h,l,u)}function wd(t,e){return function(t,e){var n=this,r=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(n,void 0,void 0,function(){var n;return Object(_.d)(this,function(i){switch(i.label){case 0:return n=Bh,[4,kl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(lf(t),e)}function Id(t,e,n){var r=n.docs.get(e._key),i=new vd(t);return new Yf(t,i,e._key,r,new Hf(n.hasPendingWrites,n.fromCache),e.converter)}var Td=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(_.c)(e,t),e.prototype.get=function(e){var n=this,r=gd(e,this._firestore),i=new vd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Yf(n._firestore,i,r._key,t._document,new Hf(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Of(t)}return t.prototype.get=function(t){var e=this,n=gd(t,this._firestore),r=new pd(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Gr();var i=t[0];if(i.isFoundDocument())return new zf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new zf(e._firestore,r,n._key,null,n.converter);throw Gr()})},t.prototype.set=function(t,e,n){var r=gd(t,this._firestore),i=dd(r.converter,e,n),o=Sf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=gd(t,this._firestore);return o="string"==typeof(e=Object(O.i)(e))||e instanceof yf?Rf(this._dataReader,"Transaction.update",s._key,e,n,r):xf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=gd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function Ed(){if("undefined"==typeof Uint8Array)throw new Fr(Lr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function _d(){if("undefined"==typeof atob)throw new Fr(Lr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Od=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return _d(),new t(gf.fromBase64String(e))},t.fromUint8Array=function(e){return Ed(),new t(gf.fromUint8Array(e))},t.prototype.toBase64=function(){return _d(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Ed(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Sd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){pf(t=Xl(t,hf));var n=lf(t),r=t._freezeSettings(),i=new bl;return df(n,i,new vl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){pf(t=Xl(t,hf));var e=lf(t),n=t._freezeSettings(),r=new bl;return df(e,r,new ml(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Fr(Lr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new ja;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(_.b)(e,void 0,void 0,function(){var e;return Object(_.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(_.b)(this,void 0,void 0,function(){return Object(_.d)(this,function(e){switch(e.label){case 0:return xa.yt()?[4,xa.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Gu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Ad=function(){function t(t,e,n){var r=this;this._delegate=e,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Ll||(this.Zc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Br("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=Xl(t,Zl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Br("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=Object(O.e)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Fr(Lr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Vl(new Ml(o,new Ic(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(_.b)(e,void 0,void 0,function(){var e,n;return Object(_.d)(this,function(r){switch(r.label){case 0:return[4,Nl(t)];case 1:return e=r.sent(),[4,jl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Qr(t);return e.Or.delete(0),Wc(e)}(n))]}})})})}(lf(Xl(this._delegate,hf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(_.b)(e,void 0,void 0,function(){var e,n;return Object(_.d)(this,function(r){switch(r.label){case 0:return[4,Nl(t)];case 1:return e=r.sent(),[4,jl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(_.b)(this,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){switch(n.label){case 0:return(e=Qr(t)).Or.add(0),[4,Hc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(lf(Xl(this._delegate,hf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Ql("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance("firestore"),this.Zc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(e,void 0,void 0,function(){var e;return Object(_.d)(this,function(r){switch(r.label){case 0:return e=Hh,[4,kl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(lf(Xl(this._delegate,hf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new wl(e);return t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(n,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Qr(t).Gr.add(e),e.next()},[4,Cl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(n,void 0,void 0,function(){var e;return Object(_.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Qr(t).Gr.delete(e)},[4,Cl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(lf(t=Xl(t,hf)),cf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Zc)throw new Fr(Lr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Ud(this,rf(this._delegate,t))}catch(t){throw xd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Cd(this,of(this._delegate,t))}catch(t){throw xd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Md(this,function(t,e){if(t=Xl(t,Zl),Gl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ef(t,null,function(t){return new ro(ii.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw xd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(n,void 0,void 0,function(){var n;return Object(_.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return Al(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new Tl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(lf(t),function(n){return e(new Td(t,n))})}(this._delegate,function(n){return t(new Dd(e,n))})},t.prototype.batch=function(){var t=this;return lf(this._delegate),new jd(new yd(this._delegate,function(e){return wd(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new Fr(Lr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Fr(Lr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Nd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(_.c)(e,t),e.prototype.convertBytes=function(t){return new Od(new gf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Cd.tu(e,this.firestore,null)},e}(fd),Dd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Nd(t)}return t.prototype.get=function(t){var e=this,n=Bd(t);return this._delegate.get(n).then(function(t){return new Ld(e._firestore,new Yf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=Bd(t);return n?(zl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Bd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(_.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Bd(t);return this._delegate.delete(e),this},t}(),jd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Bd(t);return n?(zl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Bd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(_.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Bd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),kd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Xf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Fd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.eu=function(e,n){var r=t.nu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Nd(e),n),i.set(n,o)),o},t}();kd.nu=new WeakMap;var Cd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Nd(t)}return t.su=function(e,n,r){if(e.length%2!=0)throw new Fr(Lr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new tf(n._delegate,r,new bi(e)))},t.tu=function(e,n,r){return new t(n,new tf(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Ud(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Ud(this.firestore,rf(this._delegate,t))}catch(t){throw xd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(O.i)(t))instanceof tf&&sf(this._delegate,t)},t.prototype.set=function(t,e){e=zl("DocumentReference.set",e);try{return function(t,e,n){t=Xl(t,tf);var r=Xl(t.firestore,hf),i=dd(t.converter,e,n);return wd(r,[Sf(Of(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Mo.none())])}(this._delegate,t,e)}catch(t){throw xd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?md(this._delegate,t):md.apply(void 0,Object(_.f)([this._delegate,t,e],n))}catch(t){throw xd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return wd(Xl((t=this._delegate).firestore,hf),[new Zo(t._key,Mo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Rd(e),i=Pd(e,function(e){return new Ld(t.firestore,new Yf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return bd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Xl(t,tf);var e=Xl(t.firestore,hf),n=lf(e),r=new vd(e);return function(t,e){var n=this,r=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(n,void 0,void 0,function(){var n;return Object(_.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r,i;return Object(_.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Qr(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Fr(Lr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=bh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Dl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new Yf(e,r,t._key,n,new Hf(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Xl(t,tf);var e=Xl(t.firestore,hf);return xl(lf(e),t._key,{source:"server"}).then(function(n){return Id(e,t,n)})}(this._delegate):function(t){t=Xl(t,tf);var e=Xl(t.firestore,hf);return xl(lf(e),t._key).then(function(n){return Id(e,t,n)})}(this._delegate)).then(function(t){return new Ld(e.firestore,new Yf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?kd.eu(this.firestore,e):null))},t}();function xd(t,e,n){return t.message=t.message.replace(e,n),t}function Rd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!cf(r))return r}return{}}function Pd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=cf(t[0])?t[0]:cf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Ld=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Cd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Zf(this._delegate,t._delegate)},t}(),Fd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Ld),Md=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Nd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,nd(this._delegate,function(t,e,n){var r=e,i=Wf("where",t);return new rd(i,r,n)}(e,n,r)))}catch(e){throw xd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,nd(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Wf("orderBy",t);return new id(r,n)}(e,n)))}catch(e){throw xd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,nd(this._delegate,function(t){return $l("limit",t),new od("limit",t,"F")}(e)))}catch(e){throw xd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,nd(this._delegate,function(t){return $l("limitToLast",t),new od("limitToLast",t,"L")}(e)))}catch(e){throw xd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,nd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sd("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw xd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,nd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sd("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw xd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,nd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ad("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw xd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,nd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ad("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw xd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return af(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Xl(t,ef);var e=Xl(t.firestore,hf),n=lf(e),r=new vd(e);return function(t,e){var n=this,r=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(_.b)(n,void 0,void 0,function(){var n;return Object(_.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(_.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(_.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,oc(t,e,!0)];case 1:return a=u.sent(),r=new Ph(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=bh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,Dl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new $f(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Xl(t,ef);var e=Xl(t.firestore,hf),n=lf(e),r=new vd(e);return Rl(n,t._query,{source:"server"}).then(function(n){return new $f(e,r,t,n)})}(this._delegate):function(t){t=Xl(t,ef);var e=Xl(t.firestore,hf),n=lf(e),r=new vd(e);return td(t._query),Rl(n,t._query).then(function(n){return new $f(e,r,t,n)})}(this._delegate)).then(function(t){return new Vd(e.firestore,new $f(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Rd(e),i=Pd(e,function(e){return new Vd(t.firestore,new $f(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return bd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?kd.eu(this.firestore,e):null))},t}(),qd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Fd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Vd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Md(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Fd(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new qd(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new Fd(n._firestore,r))})},t.prototype.isEqual=function(t){return Zf(this._delegate,t._delegate)},t}(),Ud=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(_.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Cd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Cd(this.firestore,void 0===t?of(this._delegate):of(this._delegate,t))}catch(t){throw xd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Xl(t.firestore,hf),r=of(t),i=dd(t.converter,e);return wd(n,[Sf(Of(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Mo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new Cd(e.firestore,t)})},e.prototype.isEqual=function(t){return sf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?kd.eu(this.firestore,t):null))},e}(Md);function Bd(t){return Xl(t,tf)}var Kd,Gd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(yf.bind.apply(yf,Object(_.f)([void 0],t)))}return t.documentId=function(){return new t(si.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(O.i)(t))instanceof yf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),zd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Df("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Af("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new kf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Cf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Qd=n("/6Yf"),Wd={Firestore:Ad,GeoPoint:mf,Timestamp:Jr,Blob:Od,Transaction:Dd,WriteBatch:jd,DocumentReference:Cd,DocumentSnapshot:Ld,Query:Md,QueryDocumentSnapshot:Fd,QuerySnapshot:Vd,CollectionReference:Ud,FieldPath:Gd,FieldValue:zd,setLogLevel:function(t){Mr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Qd.a("firestore",function(t){return function(t,e){return new Ad(t,new hf(t,e),new Sd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Wd)))})(Kd=E.a),Kd.registerVersion("@firebase/firestore","2.3.8");var Hd=n("UbJi");function Yd(t,e){return function(t,e=s.b){return new r.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Xd(t,e){return Yd(t,e).pipe(Object(p.a)(t=>({payload:t,type:"query"})))}function $d(t,e){return Xd(t,e).pipe(Object(c.a)(void 0),l(),Object(p.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function Jd(t,e,n){return $d(t,n).pipe(Object(y.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Zd(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Zd(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Zd(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),t=>t.lift(new g(void 0,void 0)),Object(p.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function Zd(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function tp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class ep{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=$d(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(p.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(c.a)(void 0),l(),Object(m.a)(([t,e])=>e.length>0||!t),Object(p.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(y.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=tp(t);return Jd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Xd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(p.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(a.a)(this.query.get(t)).pipe(Object(b.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new np(this.ref.doc(t),this.afs)}}class np{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=up(n,e);return new ep(r,i,this.afs)}snapshotChanges(){return Yd(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(c.a)(void 0),l(),Object(p.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(p.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(a.a)(this.ref.get(t)).pipe(Object(b.b)(this.afs.schedulers.insideAngular))}}class rp{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?$d(this.query,this.afs.schedulers.outsideAngular).pipe(Object(p.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(m.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):$d(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(y.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=tp(t);return Jd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Xd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(p.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(a.a)(this.query.get(t)).pipe(Object(b.b)(this.afs.schedulers.insideAngular))}}const ip=new i.q("angularfire2.enableFirestorePersistence"),op=new i.q("angularfire2.firestore.persistenceSettings"),sp=new i.q("angularfire2.firestore.settings"),ap=new i.q("angularfire2.firestore.use-emulator");function up(t,e=(t=>t)){return{query:e(t),ref:t}}let cp=(()=>{class t{constructor(t,e,n,r,i,o,s,c,h){this.schedulers=new w.d(o),this.keepUnstableUntilFirst=Object(w.h)(this.schedulers);const l=Object(w.g)(t,o,e);!T.a.auth&&h&&Object(w.j)();const f=c;[this.firestore,this.persistenceEnabled$]=Object(w.f)(l.name+".firestore","AngularFirestore",l,()=>{const t=o.runOutsideAngular(()=>l.firestore());if(r&&t.settings(r),f&&t.useEmulator(...f),n&&!Object(I.p)(i)){const e=()=>{try{return Object(a.a)(t.enablePersistence(s||void 0).then(()=>!0,()=>!1))}catch(Kd){return"undefined"!=typeof console&&console.warn(Kd),Object(u.a)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,Object(u.a)(!1)]},[r,f,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=up(n,e),o=this.schedulers.ngZone.run(()=>r);return new ep(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new rp(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new np(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(i.Pb(w.c),i.Pb(w.b,8),i.Pb(ip,8),i.Pb(sp,8),i.Pb(i.B),i.Pb(i.z),i.Pb(op,8),i.Pb(ap,8),i.Pb(Hd.b,8))},t.\u0275prov=i.Eb({factory:function(){return new t(i.Pb(w.c),i.Pb(w.b,8),i.Pb(ip,8),i.Pb(sp,8),i.Pb(i.B),i.Pb(i.z),i.Pb(op,8),i.Pb(ap,8),i.Pb(Hd.b,8))},token:t,providedIn:"any"}),t})(),hp=(()=>{class t{constructor(t,e){this.config=t,this.firestore=e}post(t,e){return this.firestore.collection(t).doc().set(e)}getAll(t){let e=[];return this.firestore.collection(t).get().subscribe(t=>{t.docs.forEach(t=>{e.push(Object.assign({id:t.id},t.data()))})}),new r.a(t=>{t.next(e)})}getSingle(t,e){let n={};return new r.a(r=>{this.firestore.collection(t).doc(e).get().subscribe(t=>{n=Object.assign({id:t.id},t.data()),r.next(n)})})}put(t,e,n){return this.firestore.collection(t).doc(e).update(n)}delete(t,e){return this.firestore.collection(t).doc(e).delete()}getWithQuery(t,e,n,i){let o=[];return new r.a(r=>{this.firestore.collection(t,t=>t.where(e,n,i)).get().subscribe(t=>{t.forEach(t=>{o.push(Object.assign({id:t.id},t.data()))}),r.next(o)})})}formatDataListing(t){let e=Object.entries(t),n=[];return e.forEach(t=>{n.push(Object.assign({Id:t[0]},t[1]))}),n.reverse()}}return t.\u0275fac=function(e){return new(e||t)(i.Pb(o.a),i.Pb(cp))},t.\u0275prov=i.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},UbJi:function(t,e,n){"use strict";n.d(e,"a",function(){return k}),n.d(e,"b",function(){return O});var r=n("fXoL"),i=n("XNiG"),o=n("LRne"),s=n("HDdC"),a=n("Cfvw"),u=n("VRyK"),c=n("pxpQ"),h=n("eIep"),l=n("lJxs"),f=n("qgXg"),d=n("quSY"),p=n("9ppp"),y=n("Ylt2");class g extends i.a{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n){super(),this.scheduler=n,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new v(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,n=e?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;let o;if(this.closed)throw new p.a;if(this.isStopped||this.hasError?o=d.a.EMPTY:(this.observers.push(t),o=new y.a(this,t)),r&&t.add(t=new c.a(t,r)),e)for(let s=0;s<i&&!t.closed;s++)t.next(n[s]);else for(let s=0;s<i&&!t.closed;s++)t.next(n[s].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),o}_getNow(){return(this.scheduler||f.a).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length;let o=0;for(;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r}}class v{constructor(t,e){this.time=t,this.value=e}}function m(t,e,n){let r;return r=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},t=>t.lift(function({bufferSize:t=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:n,scheduler:r}){let i,o,s=0,a=!1,u=!1;return function(c){let h;s++,!i||a?(a=!1,i=new g(t,e,r),h=i.subscribe(this),o=c.subscribe({next(t){i.next(t)},error(t){a=!0,i.error(t)},complete(){u=!0,o=void 0,i.complete()}}),u&&(o=void 0)):h=i.subscribe(this),this.add(()=>{s--,h.unsubscribe(),h=void 0,o&&!u&&n&&0===s&&(o.unsubscribe(),o=void 0,i=void 0)})}}(r))}var b=n("SxV6");function w(t,e){return e?Object(h.a)(()=>t,e):Object(h.a)(()=>t)}var I=n("tf+s"),T=n("pLZG"),E=n("spgP"),_=n("ofXK");const O=new r.q("angularfire2.auth.use-emulator"),S=new r.q("angularfire2.auth.settings"),A=new r.q("angularfire2.auth.tenant-id"),N=new r.q("angularfire2.auth.langugage-code"),D=new r.q("angularfire2.auth.use-device-language"),j=new r.q("angularfire.auth.persistence");let k=(()=>{class t{constructor(t,e,r,f,d,p,y,g,v,O){const S=new E.d(f),A=Object(E.h)(S),N=new i.a,D=Object(o.a)(void 0).pipe(Object(c.b)(S.outsideAngular),Object(h.a)(()=>f.runOutsideAngular(()=>n.e(11).then(n.bind(null,"6nsN")))),Object(l.a)(()=>Object(E.g)(t,f,e)),Object(l.a)(t=>f.runOutsideAngular(()=>{const e=d,n=p;return Object(E.f)(t.name+".auth","AngularFireAuth",t,()=>{const r=f.runOutsideAngular(()=>t.auth());if(e&&r.useEmulator("http://"+e.join(":")),y&&(r.tenantId=y),r.languageCode=g,v&&r.useDeviceLanguage(),n)for(const[t,e]of Object.entries(n))r.settings[t]=e;return O&&r.setPersistence(O),r},[e,y,g,v,n,O])})),m({bufferSize:1,refCount:!1}));if(Object(_.p)(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Object(o.a)(null);else{D.pipe(Object(b.a)()).subscribe();const t=D.pipe(Object(h.a)(t=>t.getRedirectResult().then(t=>t,()=>null)),A,m({bufferSize:1,refCount:!1})),e=t=>new s.a(e=>({unsubscribe:f.runOutsideAngular(()=>t(e))})),n=D.pipe(Object(h.a)(t=>e(t.onAuthStateChanged.bind(t)))),r=D.pipe(Object(h.a)(t=>e(t.onIdTokenChanged.bind(t))));this.authState=t.pipe(w(n),Object(I.a)(S.outsideAngular),Object(c.b)(S.insideAngular)),this.user=t.pipe(w(r),Object(I.a)(S.outsideAngular),Object(c.b)(S.insideAngular)),this.idToken=this.user.pipe(Object(h.a)(t=>t?Object(a.a)(t.getIdToken()):Object(o.a)(null))),this.idTokenResult=this.user.pipe(Object(h.a)(t=>t?Object(a.a)(t.getIdTokenResult()):Object(o.a)(null))),this.credential=Object(u.a)(t,N,this.authState.pipe(Object(T.a)(t=>!t))).pipe(Object(l.a)(t=>(null==t?void 0:t.user)?t:null),Object(I.a)(S.outsideAngular),Object(c.b)(S.insideAngular))}return Object(E.i)(this,D,f,{spy:{apply:(t,e,n)=>{(t.startsWith("signIn")||t.startsWith("createUser"))&&n.then(t=>N.next(t))}}})}}return t.\u0275fac=function(e){return new(e||t)(r.Pb(E.c),r.Pb(E.b,8),r.Pb(r.B),r.Pb(r.z),r.Pb(O,8),r.Pb(S,8),r.Pb(A,8),r.Pb(N,8),r.Pb(D,8),r.Pb(j,8))},t.\u0275prov=r.Eb({factory:function(){return new t(r.Pb(E.c),r.Pb(E.b,8),r.Pb(r.B),r.Pb(r.z),r.Pb(O,8),r.Pb(S,8),r.Pb(A,8),r.Pb(N,8),r.Pb(D,8),r.Pb(j,8))},token:t,providedIn:"any"}),t})();Object(E.e)(k,[{app:null,applyActionCode:null,checkActionCode:null,confirmPasswordReset:null,createUserWithEmailAndPassword:null,currentUser:null,fetchSignInMethodsForEmail:null,isSignInWithEmailLink:null,getRedirectResult:null,languageCode:null,settings:null,onAuthStateChanged:null,onIdTokenChanged:null,sendSignInLinkToEmail:null,sendPasswordResetEmail:null,setPersistence:null,signInAndRetrieveDataWithCredential:null,signInAnonymously:null,signInWithCredential:null,signInWithCustomToken:null,signInWithEmailAndPassword:null,signInWithPhoneNumber:null,signInWithEmailLink:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,tenantId:null,updateCurrentUser:null,useDeviceLanguage:null,useEmulator:null,verifyPasswordResetCode:null}])},edgM:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("fXoL");let i=(()=>{class t{constructor(){this.collections={users:"users",postings:"postings",categories:"categories",posts:"posts"}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);